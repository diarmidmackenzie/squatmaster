{"version":3,"file":"squatmaster.min.js","mappings":"CAAA,SAA2CA,EAAMC,GAChD,GAAsB,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,SACb,GAAqB,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,OACP,CACJ,IAAIK,EAAIL,IACR,IAAI,IAAIM,KAAKD,GAAuB,iBAAZJ,QAAuBA,QAAUF,GAAMO,GAAKD,EAAEC,EACvE,CACA,CATD,CASGC,MAAM,I,sBCNTC,OAAOC,kBAAkB,cAAe,CAEtCC,aAAc,CAAC,gBAEfC,OAAQ,CAGNC,aAAe,CAACC,KAAM,OAAQC,QAAS,CAACC,EAAG,EAAGC,EAAG,IAAKC,GAAI,KAG1DC,UAAY,CAACJ,QAAS,KAGtBK,YAAa,CAACL,QAAS,GAGvBM,gBAAiB,CAACN,QAAS,KAG3BO,UAAW,CAACP,QAAS,GAGrBQ,UAAW,CAACR,QAAS,IAGvBS,OAEEC,KAAKC,MAAQ,CACXC,YAAa,EACbC,eAAgB,EAChBC,gBAAiB,EACjBC,OAAQ,EACRC,YAAa,EACbC,iBAAkB,EAEtB,EAEAC,aAAaC,GAEX,IAAIC,EAAUC,EAEVC,KAAKC,IAAIJ,EAAYlB,EAAIS,KAAKc,KAAK1B,aAAaG,GAAKS,KAAKc,KAAKjB,UAAY,IAC7Ea,GAAW,GAKb,MAAMK,EAAUN,EAAYhB,EAAIO,KAAKc,KAAK1B,aAAaK,EAMvD,OALI,EAAYO,KAAKc,KAAKhB,WACtB,GAAa,KACfa,GAAW,GAGLD,GAAYC,CAEtB,EAEAK,kBAAkBP,GAiBhB,OAhBIT,KAAKQ,aAAaC,IAEfT,KAAKC,MAAMC,YACdF,KAAKiB,GAAGC,KAAK,gBAGflB,KAAKC,MAAMC,YAAa,IAGpBF,KAAKC,MAAMC,YACbF,KAAKiB,GAAGC,KAAK,eAGflB,KAAKC,MAAMC,YAAa,GAGnBF,KAAKC,MAAMC,UACpB,EAEAiB,UAAUV,GAER,IAAIW,EAAWC,EAmBf,OAhBIT,KAAKC,IAAIJ,EAAYlB,EAAIS,KAAKc,KAAK1B,aAAaG,GAAKS,KAAKc,KAAKjB,UAAY,IAC7EuB,GAAY,GAWVR,KAAKC,IAAIb,KAAKc,KAAK1B,aAAaK,EAAIgB,EAAYhB,GAAK,MACvD4B,GAAY,GAGPD,GAAaC,CACtB,EAEAC,eAAeb,GAuCb,OArCIT,KAAKmB,UAAUV,IACZT,KAAKC,MAAME,eACdH,KAAKiB,GAAGC,KAAK,iBAEflB,KAAKC,MAAME,eAAgB,IAGvBH,KAAKC,MAAME,gBAITM,EAAYjB,EAAIQ,KAAKc,KAAK1B,aAAaI,GAGpCQ,KAAKC,MAAMG,gBAEdJ,KAAKiB,GAAGC,KAAK,kBAGflB,KAAKC,MAAMG,gBAAiB,IAKxBJ,KAAKC,MAAMG,gBAEbJ,KAAKiB,GAAGC,KAAK,gBAGflB,KAAKC,MAAMG,gBAAiB,GAG9BJ,KAAKiB,GAAGC,KAAK,eAEflB,KAAKC,MAAME,eAAgB,GAGtBH,KAAKC,MAAME,aACpB,EAEAoB,QAAQd,GAGN,OAAIT,KAAKc,KAAKpB,UAAYe,EAAYjB,EAAI,GAM5C,EAEAgC,aAAaf,GAiBX,OAhBIT,KAAKuB,QAAQd,IAEVT,KAAKC,MAAMI,OACdL,KAAKiB,GAAGC,KAAK,WAGflB,KAAKC,MAAMI,OAAQ,IAGfL,KAAKC,MAAMI,OACbL,KAAKiB,GAAGC,KAAK,oBAGflB,KAAKC,MAAMI,OAAQ,GAGdL,KAAKC,MAAMI,KACpB,EAEAoB,aAAahB,GAGX,OAAIA,EAAYjB,EAAIQ,KAAKc,KAAKnB,WAMhC,EAEA+B,kBAAkBjB,GAiBhB,OAhBIT,KAAKyB,aAAahB,IAEfT,KAAKC,MAAMK,YACdN,KAAKiB,GAAGC,KAAK,oBAGflB,KAAKC,MAAMK,YAAa,IAGpBN,KAAKC,MAAMK,YACbN,KAAKiB,GAAGC,KAAK,6BAGflB,KAAKC,MAAMK,YAAa,GAGnBN,KAAKC,MAAMK,UACpB,EAEAqB,kBAAkBlB,GAIhB,OAAIA,EAAYjB,EAAKQ,KAAKc,KAAKlB,gBAAkB,GAMnD,EAEAgC,uBAAuBnB,GAoBrB,OAnBIT,KAAK2B,kBAAkBlB,IAEpBT,KAAKC,MAAMM,iBACdP,KAAKiB,GAAGC,KAAK,qBAGflB,KAAKC,MAAMM,iBAAkB,IAGzBP,KAAKC,MAAMM,kBACbP,KAAKiB,GAAGC,KAAK,cAGblB,KAAKC,MAAMG,gBAAiB,GAG9BJ,KAAKC,MAAMM,iBAAkB,GAGxBP,KAAKC,MAAMM,eACpB,EAEAsB,OACEpB,YAAcT,KAAKiB,GAAGa,QAAQC,WAAW,gBAAgBtB,YAGtCT,KAAKgB,kBAAkBP,eAO1CT,KAAKsB,eAAeb,aAGpBT,KAAKwB,aAAaf,aAGlBT,KAAK0B,kBAAkBjB,aAGvBT,KAAK4B,uBAAuBnB,aAE9B,G,WC3PFzB,OAAOC,kBAAkB,eAAgB,CAEvCc,OAIEC,KAAKgC,eAAiB,IAAIC,MAAMC,QAChClC,KAAKmC,iBAAmB,IAAIF,MAAMG,WAGlCpC,KAAKqC,eAAiB,IAAIJ,MAAMG,WAGhCpC,KAAKsC,OAASC,SAASC,cAAc,SACrCC,KAAOzC,KAAKsC,OAAOI,SACnB1C,KAAK2C,qBAAuB,IAAIV,MAAMW,QACtCH,KAAKI,oBACL7C,KAAK2C,qBAAqBG,KAAKL,KAAKM,aACpC/C,KAAK2C,qBAAqBK,SAK1BhD,KAAKS,YAAc,IAAIwB,MAAMC,QAE7BlC,KAAKiD,UAAY,IAAIhB,MAAMC,QAE3BlC,KAAKiD,UAAUC,IAAI,GAAI,IAAM,IAC7BlD,KAAKmD,yBAEP,EAEAA,0BAEE,MAAMC,EAAWpD,KAAKgC,eAChBqB,EAAarD,KAAKmC,iBAExBnC,KAAKiB,GAAGa,QAAQwB,OAAOC,iBAAiBH,GACxCpD,KAAKiB,GAAGa,QAAQwB,OAAOE,mBAAmBH,GAE1C,MAAMV,EAAuB3C,KAAK2C,qBAClCS,EAASK,aAAad,GACtB3C,KAAKqC,eAAeqB,sBAAsBf,GAC1CU,EAAWM,SAAS3D,KAAKqC,gBAEzBrC,KAAKS,YAAYmD,WAAW5D,KAAKgC,eAAgBhC,KAAKiD,UAIxD,EAEAY,SAGA,EAEAhC,OAEE7B,KAAKmD,yBACP,G,WCzEF,MAAMW,EAAwB,CAC5BC,MAAO,sJACPC,MAAO,kFACPC,IAAK,qDACLC,MAAO,gEACPC,OAAQ,8DACRC,OAAQ,yEACRC,KAAM,+BAGFC,EAAyB,CAC7BP,MAAO,GACPC,MAAO,sBACPC,IAAK,yBACLC,MAAO,eACPC,OAAQ,mBACRC,OAAQ,GACRC,KAAM,IAGRrF,OAAOC,kBAAkB,mBAAoB,CAE3CC,aAAc,CAAC,gBAEfa,OAEEC,KAAKuE,SAAWvE,KAAKuE,SAASC,KAAKxE,MACnCA,KAAKyE,WAAazE,KAAKyE,WAAWD,KAAKxE,MAEvCA,KAAKiB,GAAGyD,iBAAiB,MAAO1E,KAAKuE,UACrCvE,KAAKiB,GAAGyD,iBAAiB,QAAS1E,KAAKyE,YAGvCzE,KAAK2E,MAAQ,QACb3E,KAAK4E,QAAS,EACd5E,KAAK6E,UAAW,EAEhB7E,KAAK8E,cAAgBvC,SAASwC,eAAe,iBAC/C,EAEAlB,SACE7D,KAAKgF,UACP,EAEAC,SACEjF,KAAKiB,GAAGiE,oBAAoB,MAAOlF,KAAKuE,UACxCvE,KAAKiB,GAAGiE,oBAAoB,QAASlF,KAAKyE,WAC5C,EAEAU,0BAEEnF,KAAK2E,MAAQ,QACb3E,KAAK8E,cAAcpC,SAAS0C,SAAU,EACtCpF,KAAKgF,UAEP,EAEAK,wBACErF,KAAK8E,cAAcpC,SAAS0C,SAAU,EACtCpF,KAAKiB,GAAGC,KAAK,uBACf,EAEAoE,iBAGE,OADkBtF,KAAKiB,GAAGc,WAAW,gBACpBtB,WACnB,EAGA8E,YAAYZ,GAEV3E,KAAK4E,QAAS,EACd5E,KAAKgF,WAELQ,YAAW,KACTxF,KAAK2E,MAAQA,EACb3E,KAAK4E,QAAS,EACd5E,KAAKgF,UAAS,GACb,IACL,EAGAS,gBAAgBd,GAEd3E,KAAK6E,UAAW,EAGhBW,YAAW,KACTxF,KAAK2E,MAAQA,EACb3E,KAAK6E,UAAW,EAChB7E,KAAKgF,UAAS,GACb,IACL,EAEAT,WAIE,OAAQvE,KAAK2E,OAEX,IAAK,QAEH3E,KAAKuF,YAAY,SACjB,MAEF,IAAK,QAEH,MAAMG,EAAM,IAAIzD,MAAMC,QACtBwD,EAAI5C,KAAK9C,KAAKsF,kBACdtF,KAAKiB,GAAG0E,aAAa,cAAe,CAACvG,aAAcsG,IACnD1F,KAAKuF,YAAY,OACjB,MAEF,IAAK,MACHK,KAAO5F,KAAKsF,iBAAiB9F,EAC7BQ,KAAKiB,GAAG0E,aAAa,cAAe,CAACjG,UAAWkG,OAChD5F,KAAKuF,YAAY,SACjB,MAEF,IAAK,QACHK,KAAO5F,KAAKsF,iBAAiB9F,EAC7BQ,KAAKiB,GAAG0E,aAAa,cAAe,CAAChG,YAAaiG,OAClD5F,KAAKuF,YAAY,UACjB,MAEF,IAAK,SACHK,KAAO5F,KAAKsF,iBAAiB9F,EAC7BQ,KAAKiB,GAAG0E,aAAa,cAAe,CAAC/F,gBAAiBgG,OACtD5F,KAAKuF,YAAY,UACjB,MAEF,IAAK,SACHvF,KAAKuF,YAAY,QACjB,MAEF,IAAK,OACHvF,KAAKqF,wBACL,MAEF,QACEQ,QAAQC,MAAM,gCAAiC9F,KAAK2E,OAG1D,EAEAF,aAEE,OAAQzE,KAAK2E,OAEX,IAAK,QAwBL,IAAK,OAGH,MAvBF,IAAK,QACH3E,KAAKyF,gBAAgB,SACrB,MAEF,IAAK,MACHzF,KAAKyF,gBAAgB,SACrB,MAEF,IAAK,QACHzF,KAAKyF,gBAAgB,OACrB,MAEF,IAAK,SACHzF,KAAKyF,gBAAgB,SACrB,MAEF,IAAK,SACHzF,KAAKyF,gBAAgB,UACrB,MAOF,QACEI,QAAQC,MAAM,gCAAiC9F,KAAK2E,OAG1D,EAEAK,WAEEhF,KAAK8E,cAAca,aAAa,iBACC,CAACf,OAAQ5E,KAAK4E,OACbC,SAAU7E,KAAK6E,SACfzB,SAAUkB,EAAuBtE,KAAK2E,OACtCoB,QAASjC,EAAsB9D,KAAK2E,QACxE,IAGF3F,OAAOC,kBAAkB,iBAAkB,CAEzCE,OAAQ,CACNyF,OAAQ,CAACtF,SAAS,GAClBuF,SAAU,CAACvF,SAAS,GACpB8D,SAAU,CAAC9D,QAAS,IACpByG,QAAS,CAACzG,QAAS,KAGrBS,OACEC,KAAKgG,OAASzD,SAAS0D,cAAc,YACrCjG,KAAKgG,OAAOL,aAAa,SAAU,GACnC3F,KAAKgG,OAAOL,aAAa,QAAS,UAClC3F,KAAKiB,GAAGiF,YAAYlG,KAAKgG,QAEzBhG,KAAKmG,KAAO5D,SAAS0D,cAAc,YACnCjG,KAAKmG,KAAKR,aAAa,OAAQ,CAACS,MAAO,QACPC,MAAO,EACPC,UAAW,GACXC,MAAO,WACvCvG,KAAKgG,OAAOE,YAAYlG,KAAKmG,KAC/B,EAEAtC,SAEE,IAAI2C,EAAS,GACTxG,KAAKc,KAAK8D,SACZ4B,GAAU,UAAUxG,KAAKc,KAAKsC,mBAE5BpD,KAAKc,KAAK+D,WACZ2B,GAAU,YAAYxG,KAAKc,KAAKsC,mBAGlCoD,GAAUxG,KAAKc,KAAKiF,QAEpB/F,KAAKmG,KAAKR,aAAa,OAAQ,UAAUa,IAC3C,G,WCtOFxH,OAAOC,kBAAkB,iBAAkB,CAEzCE,OAAQ,CACNsH,SAAU,CAACnH,QAAS,GACpByG,QAAS,CAACzG,QAAS,KAGrBS,OACEC,KAAKgG,OAASzD,SAAS0D,cAAc,YACrCjG,KAAKgG,OAAOL,aAAa,SAAU,IACnC3F,KAAKiB,GAAGiF,YAAYlG,KAAKgG,QAEzBhG,KAAKmG,KAAO5D,SAAS0D,cAAc,YACnCjG,KAAKmG,KAAKR,aAAa,OAAQ,CAACS,MAAO,QACPE,UAAW,GACXC,MAAO,WACvCvG,KAAKgG,OAAOE,YAAYlG,KAAKmG,KAC/B,EAEAtC,SAEE7D,KAAKmG,KAAKR,aAAa,OAAQ,UAAU3F,KAAKc,KAAKiF,YAAY/F,KAAKc,KAAK2F,sBAE3E,G,WCpBFzH,OAAOC,kBAAkB,YAAa,CAEpCE,OAAQ,CAONuH,eAAgB,CAACpH,QAAS,IAC1BqH,iBAAkB,CAACrH,QAAS,IAC5BsH,MAAO,CAACtH,SAAS,IAGnBS,OAEEC,KAAKmC,iBAAmB,IAAIF,MAAMG,WAClCpC,KAAK6G,eAAiB,IAAI5E,MAAMG,WAChCpC,KAAK8G,gBAAkB,IAAI7E,MAAMG,WACjCpC,KAAKsD,OAAStD,KAAKiB,GAAGa,QAAQwB,OAE9BtD,KAAK+G,YAAa,EAElB/G,KAAKgH,UAAY,EACjBhH,KAAKiH,YAAc,EAEnBjH,KAAKkH,oBAAsB,CAC7B,EAEArD,SACM7D,KAAKc,KAAK8F,OACZ5G,KAAKmH,QAAU5E,SAAS0D,cAAc,UACtCjG,KAAKmH,QAAQzE,SAASU,SAASF,IAAI,EAAG,GAAI,GAC1ClD,KAAKmH,QAAQxB,aAAa,QAAS,UACnC3F,KAAKmH,QAAQxB,aAAa,QAAS,mBACnC3F,KAAKsD,OAAOrC,GAAGiF,YAAYlG,KAAKmH,UAG5BnH,KAAKmH,UACPnH,KAAKmH,QAAQC,WAAWC,YAAYrH,KAAKmH,SACzCnH,KAAKmH,QAAU,KAGrB,EAGAG,kBACEtH,KAAKkH,sBAEL1B,YAAW,KACTxF,KAAKkH,sBACDlH,KAAKkH,qBAAuB,GAC9BlH,KAAKmH,QAAQxB,aAAa,OAAQ,yBACpC,GACC,IACL,EAEA9D,OAGE,GAAI7B,KAAK+G,WAEP,YADA/G,KAAK+G,YAAa,GAIpB,MAAM1D,EAAarD,KAAKmC,iBAClBoF,EAAQvH,KAAK8G,gBAanB,GAXA9G,KAAKiB,GAAGa,QAAQwB,OAAOE,mBAAmBH,GAG1CkE,EAAMzE,KAAK9C,KAAK6G,gBAChBU,EAAMvE,SACNuE,EAAMC,YAAYnE,GAIlBkE,EAAME,YACI7G,KAAK8G,KAAK,EAAEH,EAAMI,EAAEJ,EAAMI,GAC5B,UAGH,CAEH,MAAMC,EAAQ,EAAIhH,KAAKiH,KAAKN,EAAMI,GAC5BG,EAAWlH,KAAKC,IAAI+G,GAC1B/B,QAAQkC,IAAI,+BAAgCD,GAE5C,IAAIvI,EAAIgI,EAAMhI,EACVC,EAAI+H,EAAM/H,EACVC,EAAI8H,EAAM9H,EAEVmB,KAAKC,IAAItB,IAAMqB,KAAKC,IAAIrB,IAAMoB,KAAKC,IAAItB,IAAMqB,KAAKC,IAAIpB,IAExDO,KAAKgH,WAAac,EAClB9H,KAAKiH,YAAc,EAEfjH,KAAKc,KAAK8F,OACZf,QAAQkC,IAAI,8CAA+C/H,KAAKgH,YAG3DpG,KAAKC,IAAIrB,IAAMoB,KAAKC,IAAItB,IAAMqB,KAAKC,IAAIrB,IAAMoB,KAAKC,IAAIpB,IAE7DO,KAAKgH,UAAY,EACjBhH,KAAKiH,aAAea,EAEhB9H,KAAKc,KAAK8F,OACZf,QAAQkC,IAAI,gDAAiD/H,KAAKiH,eAKpEjH,KAAKgH,WAAac,EAClB9H,KAAKiH,YAAc,EAEfjH,KAAKc,KAAK8F,OACZf,QAAQkC,IAAI,8CAA+C/H,KAAKgH,WAGtE,CAGIhH,KAAKgH,UAAYhH,KAAKc,KAAK4F,iBAC7B1G,KAAKiB,GAAGC,KAAK,OACblB,KAAKgH,UAAY,EAEbhH,KAAKc,KAAK8F,QACZf,QAAQkC,IAAI,qBACZ/H,KAAKmH,QAAQxB,aAAa,OAAQ,uBAClC3F,KAAKsH,oBAILtH,KAAKiH,YAAcjH,KAAKc,KAAK6F,mBAC/B3G,KAAKiB,GAAGC,KAAK,SACblB,KAAKiH,YAAc,EAEfjH,KAAKc,KAAK8F,QACZf,QAAQkC,IAAI,uBACZ/H,KAAKmH,QAAQxB,aAAa,OAAQ,yBAClC3F,KAAKsH,oBAKTtH,KAAK6G,eAAe/D,KAAKO,EAC3B,G,WCrJFrE,OAAOgJ,iBAAiB,YAAa,CAEnC7I,OAAQ,CACNA,OAAQ,CACNkH,MAAO,CAAC/G,QAAS,GACjB4E,MAAO,CAAC5E,QAAS,GACjB2I,YAAa,CAAC3I,QAAS,KACvB4I,WAAY,CAAC5I,QAAS,KACtB6I,WAAY,CAAC7I,QAAS,KACtB8I,gBAAiB,CAAC9I,QAAS,KAC3B+I,gBAAiB,CAAC/I,QAAS,KAC3BgJ,UAAW,CAAChJ,QAAS,KACrBiJ,WAAY,CAACjJ,QAAS,KACtBkJ,aAAc,CAAClJ,QAAS,KACxBmJ,aAAc,CAACnJ,QAAS,OAI5BS,KAAKe,GACH,MAAM4H,EAAa,GACnB,IAAIC,EAKJA,EAAW,IAAI1G,MAAM2G,YAAY9H,EAAKqH,WAAYrH,EAAKoH,WAAYpH,EAAKqH,YACxEQ,EAASE,WAAW/H,EAAKuF,MAAQ,EAAGvF,EAAKoH,WAAa,EAAGpH,EAAKoD,MAAQ,GACtEwE,EAAWI,KAAKH,GAGhBA,EAAW,IAAI1G,MAAM2G,YAAY9H,EAAKqH,WAAYrH,EAAKoH,WAAYpH,EAAKqH,YACxEQ,EAASE,UAAU/H,EAAKuF,MAAQ,EAAGvF,EAAKoH,WAAa,EAAGpH,EAAKoD,MAAQ,GACrEwE,EAAWI,KAAKH,GAGhBA,EAAW,IAAI1G,MAAM2G,YAAY9H,EAAKqH,WAAYrH,EAAKmH,YAAanH,EAAKqH,YACzEQ,EAASE,WAAW/H,EAAKuF,MAAQ,EAAGvF,EAAKmH,YAAc,GAAInH,EAAKoD,MAAQ,GACxEwE,EAAWI,KAAKH,GAGhBA,EAAW,IAAI1G,MAAM2G,YAAY9H,EAAKqH,WAAYrH,EAAKmH,YAAanH,EAAKqH,YACzEQ,EAASE,UAAU/H,EAAKuF,MAAQ,EAAGvF,EAAKmH,YAAc,GAAInH,EAAKoD,MAAQ,GACvEwE,EAAWI,KAAKH,GAIhBA,EAAW,IAAI1G,MAAM8G,iBAAiBjI,EAAKsH,gBACLtH,EAAKsH,gBACLtH,EAAKwH,WAC3CK,EAASK,QAAQpI,KAAKqI,GAAG,GACzBN,EAASE,WAAW/H,EAAKuF,MAAQ,EAAGvF,EAAKyH,YAAazH,EAAKoD,MAAQ,EAAIpD,EAAKwH,UAAY,GACxFI,EAAWI,KAAKH,GAEhBA,EAAW,IAAI1G,MAAM8G,iBAAiBjI,EAAKuH,gBACLvH,EAAKuH,gBACL,KACAM,EAASK,QAAQpI,KAAKqI,GAAG,GAC/DN,EAASE,WAAW/H,EAAKuF,MAAQ,EAAGvF,EAAKyH,YAAazH,EAAKoD,MAAQ,EAAIpD,EAAKwH,WAC5EI,EAAWI,KAAKH,GAGhBA,EAAW,IAAI1G,MAAM8G,iBAAiBjI,EAAKsH,gBACLtH,EAAKsH,gBACLtH,EAAKwH,WAC3CK,EAASK,QAAQpI,KAAKqI,GAAG,GACzBN,EAASE,UAAU/H,EAAKuF,MAAQ,EAAGvF,EAAKyH,YAAazH,EAAKoD,MAAQ,EAAIpD,EAAKwH,UAAY,GACvFI,EAAWI,KAAKH,GAEhBA,EAAW,IAAI1G,MAAM8G,iBAAiBjI,EAAKuH,gBACLvH,EAAKuH,gBACL,KACAM,EAASK,QAAQpI,KAAKqI,GAAG,GAC/DN,EAASE,UAAU/H,EAAKuF,MAAQ,EAAGvF,EAAKyH,YAAazH,EAAKoD,MAAQ,EAAIpD,EAAKwH,WAC3EI,EAAWI,KAAKH,GAGhBA,EAAW,IAAI1G,MAAM8G,iBAAiBjI,EAAK2H,aACL3H,EAAK2H,aACL3H,EAAKoD,OAC3CyE,EAASK,QAAQpI,KAAKqI,GAAG,GACzBN,EAASE,WAAW/H,EAAKuF,MAAQ,EAAGvF,EAAK0H,aAAc,GACvDE,EAAWI,KAAKH,GAGhBA,EAAW,IAAI1G,MAAM8G,iBAAiBjI,EAAK2H,aACL3H,EAAK2H,aACL3H,EAAKoD,OAC3CyE,EAASK,QAAQpI,KAAKqI,GAAG,GACzBN,EAASE,UAAU/H,EAAKuF,MAAQ,EAAGvF,EAAK0H,aAAc,GACtDE,EAAWI,KAAKH,GAEhB3I,KAAK2I,SAAW1G,MAAMiH,oBAAoBC,sBAAsBT,EAClE,IAIF1J,OAAOC,kBAAkB,aAAc,CAErCE,OAAQ,CACNkH,MAAO,CAAC/G,QAAS,GACjB4E,MAAO,CAAC5E,QAAS,GACjB2I,YAAa,CAAC3I,QAAS,KACvB4I,WAAY,CAAC5I,QAAS,KACtB6I,WAAY,CAAC7I,QAAS,KACtB8I,gBAAiB,CAAC9I,QAAS,KAC3B+I,gBAAiB,CAAC/I,QAAS,KAC3BgJ,UAAW,CAAChJ,QAAS,KACrBiJ,WAAY,CAACjJ,QAAS,KACtBkJ,aAAc,CAAClJ,QAAS,KACxBmJ,aAAc,CAACnJ,QAAS,MAG1BS,OAEEC,KAAKiB,GAAG0E,aAAa,WAAY,CAACyD,UAAW,YACX/C,MAAOrG,KAAKc,KAAKuF,MACjBnC,MAAOlE,KAAKc,KAAKoD,MACjB+D,YAAajI,KAAKc,KAAKmH,YACvBC,WAAYlI,KAAKc,KAAKoH,WACtBC,WAAYnI,KAAKc,KAAKqH,WACtBC,gBAAiBpI,KAAKc,KAAKsH,gBAC3BC,gBAAiBrI,KAAKc,KAAKuH,gBAC3BC,UAAWtI,KAAKc,KAAKwH,UACrBC,WAAYvI,KAAKc,KAAKyH,WACtBC,aAAcxI,KAAKc,KAAK0H,aACxBC,aAAczI,KAAKc,KAAK2H,eAE1DzI,KAAKiB,GAAG0E,aAAa,WAAY,CAACS,MAAO,QAC3C,G,UC/HFpH,OAAOC,kBAAkB,aAAc,CAErCc,OACEC,KAAKC,MAAQ,CACXoJ,YAAY,EACZC,QAAQ,GAGVtJ,KAAKuJ,oBAAsBvJ,KAAKuJ,oBAAoB/E,KAAKxE,MACzDA,KAAKwJ,YAAcxJ,KAAKwJ,YAAYhF,KAAKxE,MACzCA,KAAKyJ,WAAazJ,KAAKyJ,WAAWjF,KAAKxE,MACvCA,KAAKiB,GAAGyD,iBAAiB,uBAAwB1E,KAAKuJ,qBACtDvJ,KAAKiB,GAAGyD,iBAAiB,eAAgB1E,KAAKwJ,aAC9CxJ,KAAKiB,GAAGyD,iBAAiB,cAAe1E,KAAKyJ,YAG7CzJ,KAAK8E,cAAgBvC,SAASwC,eAAe,kBAC7C/E,KAAK0J,aAAenH,SAASwC,eAAe,kBAC5C/E,KAAK2J,cAAgBpH,SAASwC,eAAe,mBAE7C/E,KAAK4J,WACP,EAEAL,sBACEvJ,KAAKC,MAAMoJ,YAAa,EACxBrJ,KAAK4J,WACP,EAEAJ,cACExJ,KAAKC,MAAMqJ,QAAS,EACpBtJ,KAAK4J,WACP,EAEAH,aACEzJ,KAAKC,MAAMqJ,QAAS,EACpBtJ,KAAK4J,WACP,EAEAA,YAEEC,iBAAmB,CAAC5I,EAAImE,KAClBnE,GAAMA,EAAGyB,WACXzB,EAAGyB,SAAS0C,QAAUA,EACxB,EAGEpF,KAAKC,MAAMoJ,WAETrJ,KAAKC,MAAMqJ,QACbO,iBAAiB7J,KAAK8E,eAAe,GACrC+E,iBAAiB7J,KAAK0J,cAAc,GACpCG,iBAAiB7J,KAAK2J,eAAe,KAGrCE,iBAAiB7J,KAAK8E,eAAe,GACrC+E,iBAAiB7J,KAAK0J,cAAc,GACpCG,iBAAiB7J,KAAK2J,eAAe,KAIvCE,iBAAiB7J,KAAK8E,eAAe,GACrC+E,iBAAiB7J,KAAK0J,cAAc,GACpCG,iBAAiB7J,KAAK2J,eAAe,GAEzC,G,WC7DF3K,OAAOC,kBAAkB,aAAc,CAErCc,OAEEC,KAAK8J,aAAe9J,KAAK8J,aAAatF,KAAKxE,MAC3CA,KAAK+J,UAAY/J,KAAK+J,UAAUvF,KAAKxE,MACrCA,KAAKgK,cAAgBhK,KAAKgK,cAAcxF,KAAKxE,MAC7CA,KAAKiK,YAAcjK,KAAKiK,YAAYzF,KAAKxE,MACzCA,KAAKkK,OAASlK,KAAKkK,OAAO1F,KAAKxE,MAC/BA,KAAKmK,eAAiBnK,KAAKmK,eAAe3F,KAAKxE,MAC/CA,KAAKoK,eAAiBpK,KAAKoK,eAAe5F,KAAKxE,MAC/CA,KAAKqK,uBAAyBrK,KAAKqK,uBAAuB7F,KAAKxE,MAC/DA,KAAKO,gBAAkBP,KAAKO,gBAAgBiE,KAAKxE,MACjDA,KAAKsK,UAAYtK,KAAKsK,UAAU9F,KAAKxE,MAErCA,KAAKiB,GAAGyD,iBAAiB,gBAAiB1E,KAAK8J,cAC/C9J,KAAKiB,GAAGyD,iBAAiB,aAAc1E,KAAK+J,WAC5C/J,KAAKiB,GAAGyD,iBAAiB,iBAAkB1E,KAAKgK,eAChDhK,KAAKiB,GAAGyD,iBAAiB,eAAgB1E,KAAKiK,aAC9CjK,KAAKiB,GAAGyD,iBAAiB,UAAW1E,KAAKkK,QACzClK,KAAKiB,GAAGyD,iBAAiB,mBAAoB1E,KAAKmK,gBAClDnK,KAAKiB,GAAGyD,iBAAiB,mBAAoB1E,KAAKoK,gBAClDpK,KAAKiB,GAAGyD,iBAAiB,4BAA6B1E,KAAKqK,wBAC3DrK,KAAKiB,GAAGyD,iBAAiB,oBAAqB1E,KAAKO,iBACnDP,KAAKiB,GAAGyD,iBAAiB,aAAc1E,KAAKsK,WAE5CtK,KAAKC,MAAQ,CACXsK,SAAU,OACV9D,SAAU,GAGZzG,KAAK0J,aAAenH,SAASC,cAAc,mBAC3CxC,KAAK2J,cAAgBpH,SAASC,cAAc,mBAE9C,EAEAyC,SACEjF,KAAKiB,GAAGiE,oBAAoB,gBAAiBlF,KAAK8J,cAClD9J,KAAKiB,GAAGiE,oBAAoB,aAAclF,KAAK+J,WAC/C/J,KAAKiB,GAAGiE,oBAAoB,iBAAkBlF,KAAKgK,eACnDhK,KAAKiB,GAAGiE,oBAAoB,eAAgBlF,KAAKiK,aACjDjK,KAAKiB,GAAGiE,oBAAoB,UAAWlF,KAAKkK,QAC5ClK,KAAKiB,GAAGiE,oBAAoB,mBAAoBlF,KAAKmK,gBACrDnK,KAAKiB,GAAGiE,oBAAoB,mBAAoBlF,KAAKoK,gBACrDpK,KAAKiB,GAAGiE,oBAAoB,4BAA6BlF,KAAKqK,wBAC9DrK,KAAKiB,GAAGiE,oBAAoB,oBAAqBlF,KAAKO,iBACtDP,KAAKiB,GAAGiE,oBAAoB,aAAclF,KAAKsK,UACjD,EAEAE,cAAcC,GAEZzK,KAAKC,MAAMwG,SAAWgE,EACtBzK,KAAK0J,aAAa/D,aAAa,iBAAkB,CAACc,SAAUzG,KAAKC,MAAMwG,UACzE,EAEAiE,eAEE1K,KAAKC,MAAMwG,WACXzG,KAAK0J,aAAa/D,aAAa,iBAAkB,CAACc,SAAUzG,KAAKC,MAAMwG,UACzE,EAEAqD,eAEE9J,KAAK2K,WAAW,qBAClB,EAEAZ,YAEA,EAEAC,gBACEhK,KAAK2K,WAAW,YAClB,EAEAV,cACEjK,KAAK2K,WAAW,YAClB,EAEAA,WAAW5E,GACT/F,KAAK0J,aAAa/D,aAAa,iBAAkB,CAACI,QAASA,GAC7D,EAEAmE,SAGE,OAAQlK,KAAKC,MAAMsK,UAEjB,IAAK,OACHvK,KAAKC,MAAMsK,SAAW,QACtBvK,KAAK2K,WAAW,UAChB,MAEF,IAAK,OACH3K,KAAKC,MAAMsK,SAAW,OACtBvK,KAAK2K,WAAW,kBAChB,MAEF,IAAK,KACH3K,KAAKC,MAAMsK,SAAW,OACtBvK,KAAK2K,WAAW,gBAChB3K,KAAK0K,eACL,MAEF,QACE7E,QAAQC,MAAM,gCAAiC9F,KAAKC,MAAMsK,UAEhE,EAEAJ,iBAGE,OAAQnK,KAAKC,MAAMsK,UAEjB,IAAK,OACHvK,KAAK2K,WAAW,sCAChB,MAEF,IAAK,QACL,IAAK,OACH3K,KAAKC,MAAMsK,SAAW,OACtBvK,KAAK2K,WAAW,iBAChB,MAEF,IAAK,KACH3K,KAAK2K,WAAW,8CAChB,MAEF,QACE9E,QAAQC,MAAM,yCAA0C9F,KAAKC,MAAMsK,UAGzE,EAEAH,iBAGE,OAAQpK,KAAKC,MAAMsK,UAEjB,IAAK,OACHvK,KAAK2K,WAAW,8CAChB,MAEF,IAAK,OACH3K,KAAK2K,WAAW,cAChB3K,KAAKC,MAAMsK,SAAW,KACtB,MAEF,IAAK,KACHvK,KAAK2K,WAAW,iCAChB,MAEF,QACE9E,QAAQC,MAAM,yCAA0C9F,KAAKC,MAAMsK,UAEzE,EAEAF,yBAKS,OAFCrK,KAAKC,MAAMsK,UAOf1E,QAAQC,MAAM,yCAA0C9F,KAAKC,MAAMsK,SAEzE,EAEAhK,kBAEEP,KAAK2K,WAAW,mEAElB,EAEAL,YACEtK,KAAK2K,WAAW,mEAClB,G,WCtLF3L,OAAOC,kBAAkB,oBAAqB,CAE5Cc,OAEEC,KAAK4K,iBAAmB,EACxB5K,KAAK6K,qBAAuB,EAE5B7K,KAAK8K,QAAU9K,KAAK8K,QAAQtG,KAAKxE,MACjCA,KAAK+K,MAAQ/K,KAAK+K,MAAMvG,KAAKxE,MAE7BgL,OAAOtG,iBAAiB,UAAW1E,KAAK8K,SACxCE,OAAOtG,iBAAiB,QAAS1E,KAAK+K,MACxC,EAEAD,QAAQG,GAEQ,MAAVA,EAAEC,MACJlL,KAAK6K,sBAAwB,GAGjB,MAAVI,EAAEC,MACJlL,KAAK6K,sBAAwB,EAEjC,EAEAE,MAAME,GAEU,MAAVA,EAAEC,KAAyB,MAAVD,EAAEC,MACrBlL,KAAK4K,iBAAmB,EACxB5K,KAAK6K,qBAAuB,EAEhC,EAEAhJ,KAAKsJ,EAAGC,GAENC,SAAWD,EAAKpL,KAAK6K,qBAAuB,IAC5C7K,KAAK4K,kBAAoBS,SACrBrL,KAAK4K,iBAAmB,IAAG5K,KAAK4K,iBAAmB,GACnD5K,KAAK4K,kBAAoB,IAAG5K,KAAK4K,kBAAoB,GAEzDU,OAASF,EAAKpL,KAAK4K,iBAAmB,IACtC5K,KAAKiB,GAAGyB,SAASU,SAAS5D,GAAK8L,MACjC,G,GCzCEC,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAajN,QAGrB,IAAIC,EAAS6M,EAAyBE,GAAY,CAGjDhN,QAAS,CAAC,GAOX,OAHAmN,EAAoBH,GAAU/M,EAAQA,EAAOD,QAAS+M,GAG/C9M,EAAOD,OACf,C,OCpBA,EAAQ,KACR,EAAQ,KACR,EAAQ,KACR,EAAQ,KACR,EAAQ,KACR,EAAQ,KACR,EAAQ,KACR,EAAQ,KACR,EAAQ,I","sources":["webpack://squatmaster/webpack/universalModuleDefinition","webpack://squatmaster/./src/bar-monitor.js","webpack://squatmaster/./src/bar-position.js","webpack://squatmaster/./src/calibration-flow.js","webpack://squatmaster/./src/in-rack-ui.js","webpack://squatmaster/./src/nod-shake.js","webpack://squatmaster/./src/squat-rack.js","webpack://squatmaster/./src/ui-manager.js","webpack://squatmaster/./src/ui-updater.js","webpack://squatmaster/./src/vertical-controls.js","webpack://squatmaster/webpack/bootstrap","webpack://squatmaster/./index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, () => {\nreturn ","// component set on scene.\r\n// Contains configuration of key bar thresholds.\r\n// Monitors bar position and generates events when thresholds are hit.\r\nAFRAME.registerComponent('bar-monitor', {\r\n\r\n  dependencies: ['bar-position'],\r\n\r\n  schema: {\r\n    // Position of bar when on hooks (before the lift begins)\r\n    // Co-ordinates in rack space.\r\n    hookPosition : {type: 'vec3', default: {x: 0, y: 1.5, z: -0.5}},\r\n\r\n    // height of bar when lifter is standing up straight.\r\n    topHeight : {default: 1.6},\r\n\r\n    // target depth for bar, to achieve parallel thighs.\r\n    targetDepth: {default: 1},\r\n\r\n    // height of the bar when it hits the safety pins.\r\n    safetyPinHeight: {default: 0.75},\r\n\r\n    // width of rack in meters\r\n    rackWidth: {default: 1},\r\n\r\n    // depth (z-direction) of rack in meters\r\n    rackDepth: {default: 1}\r\n  },\r\n\r\n  init() {\r\n\r\n    this.state = {\r\n      insideRack : false,\r\n      lifterAtHooks : false,\r\n      barOnShoulders : false,\r\n      atTop : false,\r\n      belowDepth : false,\r\n      belowSafetyPins : false,\r\n    }\r\n  },\r\n\r\n  isInsideRack(barPosition) {\r\n\r\n    let insideLR, insideFB\r\n\r\n    if (Math.abs(barPosition.x - this.data.hookPosition.x) < this.data.rackWidth / 2) {\r\n      insideLR = true\r\n    }\r\n\r\n    // zOffset relative to hook Position will be positive (up to rack depth)\r\n    // or very small negative (to 10cm tolerance) when inside the rack.\r\n    const zOffset = barPosition.z - this.data.hookPosition.z\r\n    if ((zOffset) < this.data.rackDepth && \r\n        (zOffset) > -0.1) {\r\n      insideFB = true\r\n    }\r\n\r\n    return (insideLR && insideFB)\r\n\r\n  },\r\n\r\n  checkIfInsideRack(barPosition) {\r\n    if (this.isInsideRack(barPosition)) {\r\n\r\n      if (!this.state.insideRack) {\r\n        this.el.emit('entered-rack')\r\n      }\r\n\r\n      this.state.insideRack = true\r\n    }\r\n    else {\r\n      if (this.state.insideRack) {\r\n        this.el.emit('exited-rack')\r\n      }\r\n\r\n      this.state.insideRack = false\r\n    }\r\n\r\n    return this.state.insideRack\r\n  },\r\n\r\n  isAtHooks(barPosition) {\r\n\r\n    let atHooksLR, atHooksFB\r\n\r\n    // for L-R, anywhere in rack will do.\r\n    if (Math.abs(barPosition.x - this.data.hookPosition.x) < this.data.rackWidth / 2) {\r\n      atHooksLR = true\r\n    }\r\n\r\n    // 10cm tolerance for Front-Back.\r\n\r\n    // Note: user can subvert logic by bringing in bar very close to pins, then lowering directly in front of pins.\r\n    // App will assume bar has been returned to rack, when in fact it's still on users' shoulders.\r\n    // This behaviour seems really unlikely to happen, unless user is deliberatly trying to subvert the app...\r\n\r\n    // Not sure we can do any better without introducing risk of false negatives when bar\r\n    // is legitimately returned to the hooks.\r\n    if (Math.abs(this.data.hookPosition.z - barPosition.z) < 0.05) {\r\n      atHooksFB = true\r\n    }\r\n\r\n    return atHooksLR && atHooksFB\r\n  },\r\n\r\n  checkIfAtHooks(barPosition) {\r\n\r\n    if (this.isAtHooks(barPosition)) {\r\n      if (!this.state.lifterAtHooks) {\r\n        this.el.emit('reached-hooks')\r\n      }\r\n      this.state.lifterAtHooks = true\r\n    }\r\n    else {\r\n      if (this.state.lifterAtHooks) {\r\n        // lifter leaving hooks.\r\n        // may or may not have bar on shoulders.  Determine based on y position.\r\n\r\n        if (barPosition.y > this.data.hookPosition.y) {\r\n          // bar above hooks - must be on shoulders.\r\n\r\n          if (!this.state.barOnShoulders) {\r\n\r\n            this.el.emit('shouldered-bar')\r\n          }\r\n          \r\n          this.state.barOnShoulders = true\r\n        }\r\n        else {\r\n          // bar below hooks - must have deposited it back on the hooks.\r\n\r\n          if (this.state.barOnShoulders) {\r\n\r\n            this.el.emit('returned-bar')\r\n          }\r\n          \r\n          this.state.barOnShoulders = false\r\n        }\r\n\r\n        this.el.emit('left-hooks')\r\n      }\r\n      this.state.lifterAtHooks = false\r\n    }\r\n\r\n    return this.state.lifterAtHooks\r\n  },\r\n\r\n  isAtTop(barPosition) {\r\n\r\n    // 5cm tolerance.  Anything over top is considered at top.\r\n    if (this.data.topHeight - barPosition.y < 0.05) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfAtTop(barPosition) {\r\n    if (this.isAtTop(barPosition)) {\r\n\r\n      if (!this.state.atTop) {\r\n        this.el.emit('hit-top')\r\n      }\r\n\r\n      this.state.atTop = true\r\n    }\r\n    else {\r\n      if (this.state.atTop) {\r\n        this.el.emit('lowered-from-top')\r\n      }\r\n\r\n      this.state.atTop = false\r\n    }\r\n\r\n    return this.state.atTop\r\n  },\r\n\r\n  isBelowDepth(barPosition) {\r\n\r\n    // Below target depth.  No tolerance - must pass target depth.\r\n    if (barPosition.y < this.data.targetDepth) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfBelowDepth(barPosition) {\r\n    if (this.isBelowDepth(barPosition)) {\r\n\r\n      if (!this.state.belowDepth) {\r\n        this.el.emit('hit-target-depth')\r\n      }\r\n\r\n      this.state.belowDepth = true\r\n    }\r\n    else {\r\n      if (this.state.belowDepth) {\r\n        this.el.emit('upwards-from-target-depth')\r\n      }\r\n\r\n      this.state.belowDepth = false\r\n    }\r\n\r\n    return this.state.belowDepth\r\n  },\r\n\r\n  isBelowSafetyPins(barPosition) {\r\n\r\n    // Below safety pins\r\n    // wait until fully 5cm below, to be sure lifter is bailing out, not just performing a deep rep.\r\n    if (barPosition.y < (this.data.safetyPinHeight - 0.05)) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfBelowSafetyPins(barPosition) {\r\n    if (this.isBelowSafetyPins(barPosition)) {\r\n\r\n      if (!this.state.belowSafetyPins) {\r\n        this.el.emit('below-safety-pins')\r\n      }\r\n\r\n      this.state.belowSafetyPins = true\r\n    }\r\n    else {\r\n      if (this.state.belowSafetyPins) {\r\n        this.el.emit('bailed-out')\r\n\r\n        // following bail-out, bar is no longer on the shoulders.\r\n        this.state.barOnShoulders = false\r\n      }\r\n\r\n      this.state.belowSafetyPins = false\r\n    }\r\n\r\n    return this.state.belowSafetyPins\r\n  },\r\n\r\n  tick() {\r\n    barPosition = this.el.sceneEl.components['bar-position'].barPosition\r\n\r\n    // is the lifter inside the rack?\r\n    const insideRack = this.checkIfInsideRack(barPosition)\r\n\r\n    // if not inside rack, nothing else can happen.\r\n    if (!insideRack) return\r\n\r\n    // is the lifter at the pins (likely either taking on, or dropping off the bar?)\r\n    // This also updates state about whether or not the lifter has the bar on their shoulders.\r\n    this.checkIfAtHooks(barPosition)\r\n\r\n    // is the lifter at the top of a rep?\r\n    this.checkIfAtTop(barPosition)\r\n\r\n    // has the lifter gone below target depth?\r\n    this.checkIfBelowDepth(barPosition)\r\n\r\n    // has the lifter bailed out on the safety pins?\r\n    this.checkIfBelowSafetyPins(barPosition)\r\n\r\n  }\r\n})","\r\n// Component set on scene.\r\n// Tracks camera and maintains public data for\r\n// - cameraPostion\r\n// - cameraQuaternion\r\n// - barPosition\r\n// All as measured in rack space.\r\n\r\n// No implemented support for switching camera / multi-camera\r\n\r\n// as far as possible, we try to work in rack space.\r\n// In rack space, x is left-right and z is forward (+ve) and backward (-ve)\r\n// Typically this will not align with world space.\r\n\r\nAFRAME.registerComponent('bar-position', {\r\n  \r\n  init() {\r\n    // called once when component is added to an entity\r\n\r\n    // camera position & quaternion in Rack Space.  Updated every tick.\r\n    this.cameraPosition = new THREE.Vector3()\r\n    this.cameraQuaternion = new THREE.Quaternion()\r\n\r\n    // for working\r\n    this.tempQuaternion = new THREE.Quaternion()\r\n\r\n    // world position of rack.\r\n    this.rackEl = document.querySelector('#rack')\r\n    rack = this.rackEl.object3D\r\n    this.rackInverseTransform = new THREE.Matrix4()\r\n    rack.updateWorldMatrix()\r\n    this.rackInverseTransform.copy(rack.matrixWorld)\r\n    this.rackInverseTransform.invert()\r\n\r\n    // now if I apply rackInverseTransform to an object in worldSpace, I get it's transform in rack space.\r\n    // vector to track bar position, in rack-space.\r\n    // Public.\r\n    this.barPosition = new THREE.Vector3()\r\n    \r\n    this.barOffset = new THREE.Vector3()\r\n    // for now, hard code bar 20 cm behind camera, 10cm below\r\n    this.barOffset.set(0, -0.1, -0.2)\r\n    this.getCameraAndBarPosition()\r\n    \r\n  },\r\n\r\n  getCameraAndBarPosition() {\r\n\r\n    const position = this.cameraPosition\r\n    const quaternion = this.cameraQuaternion\r\n\r\n    this.el.sceneEl.camera.getWorldPosition(position);\r\n    this.el.sceneEl.camera.getWorldQuaternion(quaternion);\r\n\r\n    const rackInverseTransform = this.rackInverseTransform\r\n    position.applyMatrix4(rackInverseTransform)\r\n    this.tempQuaternion.setFromRotationMatrix(rackInverseTransform)\r\n    quaternion.multiply(this.tempQuaternion)\r\n\r\n    this.barPosition.addVectors(this.cameraPosition, this.barOffset)\r\n\r\n    // bar quaternion is assumed to always be the identity\r\n    // bar in standard orientation across the rack.\r\n  },\r\n\r\n  update() {\r\n    // called whenever component properties are updated\r\n\r\n  },\r\n\r\n  tick() {\r\n\r\n    this.getCameraAndBarPosition()\r\n  }\r\n})","const calibrationUIMessages = {\r\n  start: 'Ensure your safety pins are in place at a suitable height.  Position the hooks just below shoulder height, and place an empty bar across the hooks.',\r\n  hooks: 'Without moving the bar yet, duck under and brace your shoulders against the bar',\r\n  top: 'Stand up to your full height, and take a step back',\r\n  depth: 'Squat down to your target depth: thighs parallel to the floor',\r\n  safety: 'Bend down further, so that the bar sits on your safety pins',\r\n  review: 'Stand up again.  If you are happy, nod, and return the bar to the rack',\r\n  done: 'Calibration is now complete'\r\n}\r\n\r\nconst calibrationUIPositions = {\r\n  start: '',\r\n  hooks: 'racked bar position',\r\n  top: 'height at top of squat',\r\n  depth: 'target depth',\r\n  safety: 'safety pin depth',\r\n  review: '',\r\n  done: '',\r\n}\r\n\r\nAFRAME.registerComponent('calibration-flow', {\r\n\r\n  dependencies: ['bar-position'],\r\n\r\n  init() {\r\n\r\n    this.nodEvent = this.nodEvent.bind(this)\r\n    this.shakeEvent = this.shakeEvent.bind(this)\r\n    \r\n    this.el.addEventListener('nod', this.nodEvent);\r\n    this.el.addEventListener('shake', this.shakeEvent);\r\n\r\n    // UI state\r\n    this.stage = 'start' // one of: start, hooks, top, depth, safety, review, done\r\n    this.saving = false\r\n    this.deleting = false\r\n\r\n    this.calibrationUI = document.getElementById('calibration-ui')\r\n  },\r\n\r\n  update() {\r\n    this.updateUI()\r\n  },\r\n\r\n  remove() {\r\n    this.el.removeEventListener('nod', this.nodEvent);\r\n    this.el.removeEventListener('shake', this.shakeEvent);\r\n  },\r\n\r\n  beginCalibrationProcess() {\r\n\r\n    this.stage = 'start'\r\n    this.calibrationUI.object3D.visible = true\r\n    this.updateUI()\r\n\r\n  },\r\n\r\n  endCalibrationProcess() {\r\n    this.calibrationUI.object3D.visible = false\r\n    this.el.emit('calibration-complete')\r\n  },\r\n\r\n  getBarPosition() {\r\n\r\n    const component = this.el.components['bar-position']\r\n    return component.barPosition\r\n  },\r\n\r\n  // displays \"saving\" message for 1 second, then moves to next stage.\r\n  moveToStage(stage) {\r\n\r\n    this.saving = true\r\n    this.updateUI()\r\n\r\n    setTimeout(() => {\r\n      this.stage = stage\r\n      this.saving = false\r\n      this.updateUI()\r\n    }, 1000)\r\n  },\r\n\r\n  // equivalent function when moving back a stage...\r\n  moveBackToStage(stage) {\r\n\r\n    this.deleting = true\r\n\r\n    // short timeout, just to avoid duplicate shakes...\r\n    setTimeout(() => {\r\n      this.stage = stage\r\n      this.deleting = false\r\n      this.updateUI()\r\n    }, 500)\r\n  },\r\n\r\n  nodEvent() {\r\n\r\n    let yPos\r\n\r\n    switch (this.stage) {\r\n\r\n      case 'start':\r\n        // no data to record yet.\r\n        this.moveToStage('hooks')\r\n        break\r\n\r\n      case 'hooks':\r\n        // new Vector3 to ensure update happens.\r\n        const pos = new THREE.Vector3()\r\n        pos.copy(this.getBarPosition())\r\n        this.el.setAttribute('bar-monitor', {hookPosition: pos})\r\n        this.moveToStage('top')\r\n        break\r\n  \r\n      case 'top':\r\n        ypos = this.getBarPosition().y\r\n        this.el.setAttribute('bar-monitor', {topHeight: ypos})\r\n        this.moveToStage('depth')\r\n        break\r\n\r\n      case 'depth':\r\n        ypos = this.getBarPosition().y\r\n        this.el.setAttribute('bar-monitor', {targetDepth: ypos})\r\n        this.moveToStage('safety')\r\n        break\r\n\r\n      case 'safety':\r\n        ypos = this.getBarPosition().y\r\n        this.el.setAttribute('bar-monitor', {safetyPinHeight: ypos})\r\n        this.moveToStage('review')\r\n        break\r\n\r\n      case 'review':\r\n        this.moveToStage('done')\r\n        break\r\n\r\n      case 'done':\r\n        this.endCalibrationProcess()\r\n        break\r\n\r\n      default:\r\n        console.error(\"Hit Nod in unexpected state: \", this.stage)\r\n        break\r\n    }\r\n  },\r\n\r\n  shakeEvent() {\r\n\r\n    switch (this.stage) {\r\n\r\n      case 'start':\r\n        // no effect\r\n        break\r\n\r\n      case 'hooks':\r\n        this.moveBackToStage('start')\r\n        break\r\n  \r\n      case 'top':\r\n        this.moveBackToStage('hooks')\r\n        break\r\n\r\n      case 'depth':\r\n        this.moveBackToStage('top')\r\n        break\r\n\r\n      case 'safety':\r\n        this.moveBackToStage('depth')\r\n        break\r\n\r\n      case 'review':\r\n        this.moveBackToStage('safety')\r\n        break\r\n\r\n      case 'done':\r\n        // no effect - too late\r\n        // (TBC - we could desig a flow to restart the whole calibration process again)\r\n        break\r\n         \r\n      default:\r\n        console.error(\"Hit Nod in unexpected state: \", this.stage)\r\n        break\r\n    }\r\n  },\r\n\r\n  updateUI() {\r\n\r\n    this.calibrationUI.setAttribute('calibration-ui',\r\n                                     {saving: this.saving,\r\n                                      deleting: this.deleting,\r\n                                      position: calibrationUIPositions[this.stage],\r\n                                      message: calibrationUIMessages[this.stage]})\r\n  }\r\n})\r\n\r\nAFRAME.registerComponent('calibration-ui', {\r\n\r\n  schema: {\r\n    saving: {default: false},\r\n    deleting: {default: false},\r\n    position: {default: ''},\r\n    message: {default: ''},\r\n  },\r\n\r\n  init() {\r\n    this.circle = document.createElement('a-circle')\r\n    this.circle.setAttribute('radius', 1)\r\n    this.circle.setAttribute('color', 'yellow')\r\n    this.el.appendChild(this.circle)\r\n\r\n    this.text = document.createElement('a-entity')\r\n    this.text.setAttribute('text', {color: 'black',\r\n                                    width: 2,\r\n                                    wrapCount: 40,\r\n                                    align: 'center'})\r\n    this.circle.appendChild(this.text)\r\n  },\r\n\r\n  update() {\r\n\r\n    let string = ''\r\n    if (this.data.saving) {\r\n      string += `Saving ${this.data.position}...\\n\\n`\r\n    }\r\n    if (this.data.deleting) {\r\n      string += `Deleting ${this.data.position}...\\n\\n`\r\n    }\r\n\r\n    string += this.data.message\r\n\r\n    this.text.setAttribute('text', `value: ${string}`)\r\n  }\r\n});\r\n","AFRAME.registerComponent('inside-rack-ui', {\r\n\r\n  schema: {\r\n    repsToGo: {default: 5},\r\n    message: {default: ''}\r\n  },\r\n\r\n  init() {\r\n    this.circle = document.createElement('a-circle')\r\n    this.circle.setAttribute('radius', 0.5)\r\n    this.el.appendChild(this.circle)\r\n\r\n    this.text = document.createElement('a-entity')\r\n    this.text.setAttribute('text', {color: 'black',\r\n                                    wrapCount: 15,\r\n                                    align: 'center'})\r\n    this.circle.appendChild(this.text)\r\n  },\r\n\r\n  update() {\r\n\r\n    this.text.setAttribute('text', `value: ${this.data.message}\\n${this.data.repsToGo} reps to go`)\r\n\r\n  }\r\n});\r\n","// Add to scene (it finds camera itself)\r\n// Generates 'nod' and 'shake' events\r\n\r\nAFRAME.registerComponent('nod-shake', {\r\n\r\n  schema: {\r\n    // sensitivity is measured in required cmulative radians of rotation (in either direction)\r\n    // without any significant movement that is dominated by another axis.\r\n    // 1 radian = approx 57 degrees\r\n    // For simplicity, we allow nods in both X & Z axis.  Unlikely to trigger false positives as\r\n    // head tilt is an unusual movement.  And means we don't need to worry about the camera's Y rotation.\r\n    // in determining which direction is \"nodding\"\r\n    nodSensitivity: {default: 0.5},\r\n    shakeSensitivity: {default: 0.5},\r\n    debug: {default: false}\r\n  },\r\n\r\n  init() {\r\n\r\n    this.cameraQuaternion = new THREE.Quaternion\r\n    this.lastQuaternion = new THREE.Quaternion\r\n    this.deltaQuaternion = new THREE.Quaternion\r\n    this.camera = this.el.sceneEl.camera\r\n\r\n    this.firstFrame = true\r\n\r\n    this.cumRotNod = 0\r\n    this.cumRotShake = 0\r\n\r\n    this.debugDisplayCounter = 0\r\n  },\r\n\r\n  update() {\r\n    if (this.data.debug) {\r\n      this.display = document.createElement('a-text')\r\n      this.display.object3D.position.set(0, 0, -3)\r\n      this.display.setAttribute('align', 'center')\r\n      this.display.setAttribute('value', 'Nod/shake debug')\r\n      this.camera.el.appendChild(this.display)\r\n    }\r\n    else {\r\n      if (this.display) {\r\n        this.display.parentNode.removeChild(this.display)\r\n        this.display = null\r\n      }\r\n    }\r\n  },\r\n\r\n  // primes debug display to reset 1 second after changes stop.\r\n  primeDebugReset() {\r\n    this.debugDisplayCounter++\r\n\r\n    setTimeout(() => {\r\n      this.debugDisplayCounter--\r\n      if (this.debugDisplayCounter <= 0) {\r\n        this.display.setAttribute('text', 'value: Nod/shake debug')\r\n      }\r\n    }, 1000)\r\n  },\r\n\r\n  tick() {\r\n\r\n    // avoid false positives at start of day\r\n    if (this.firstFrame) {\r\n      this.firstFrame = false\r\n      return\r\n    }\r\n\r\n    const quaternion = this.cameraQuaternion\r\n    const delta = this.deltaQuaternion\r\n\r\n    this.el.sceneEl.camera.getWorldQuaternion(quaternion);\r\n\r\n    // compute delta quaternion from last frame to this frame\r\n    delta.copy(this.lastQuaternion)\r\n    delta.invert()\r\n    delta.premultiply(quaternion)\r\n\r\n    // Convert to axis and angle as described here.\r\n    // https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm   \r\n    delta.normalize()\r\n    const s = Math.sqrt(1-delta.w*delta.w)\r\n    if (s < 0.0001) {\r\n      // no significant movement\r\n    }\r\n    else {\r\n\r\n      const angle = 2 * Math.acos(delta.w)\r\n      const absAngle = Math.abs(angle)\r\n      console.log(\"Absolute angle of rotation: \", absAngle)\r\n\r\n      let x = delta.x\r\n      let y = delta.y\r\n      let z = delta.z\r\n\r\n      if (Math.abs(x) >= Math.abs(y) && Math.abs(x) >= Math.abs(z)) {\r\n        // x axis dominant\r\n        this.cumRotNod += absAngle\r\n        this.cumRotShake = 0\r\n        \r\n        if (this.data.debug) {\r\n          console.log(\"X-axis dominant.  Accumulated nod rotation:\", this.cumRotNod)\r\n        }\r\n      }\r\n      else if (Math.abs(y) >= Math.abs(x) && Math.abs(y) >= Math.abs(z)) {\r\n        // y axis dominant\r\n        this.cumRotNod = 0\r\n        this.cumRotShake += absAngle\r\n        \r\n        if (this.data.debug) {\r\n          console.log(\"Y-axis dominant.  Accumulated shake rotation:\", this.cumRotShake)\r\n        }\r\n      }\r\n      else {\r\n        // z-axis dominant\r\n        this.cumRotNod += absAngle\r\n        this.cumRotShake = 0\r\n\r\n        if (this.data.debug) {\r\n          console.log(\"Z-axis dominant.  Accumulated nod rotation:\", this.cumRotNod)\r\n        }\r\n      }\r\n    }\r\n\r\n    // has any cumulative rotation broken threshold?\r\n    if (this.cumRotNod > this.data.nodSensitivity) {\r\n      this.el.emit(\"nod\")\r\n      this.cumRotNod = 0\r\n\r\n      if (this.data.debug) {\r\n        console.log(\"Emitted nod event\")\r\n        this.display.setAttribute('text', 'value: Detected nod')\r\n        this.primeDebugReset()\r\n      }\r\n    }\r\n\r\n    if (this.cumRotShake > this.data.shakeSensitivity) {\r\n      this.el.emit(\"shake\")\r\n      this.cumRotShake = 0\r\n\r\n      if (this.data.debug) {\r\n        console.log(\"Emitted shake event\")\r\n        this.display.setAttribute('text', 'value: Detected shake')\r\n        this.primeDebugReset()\r\n      }\r\n    }\r\n\r\n    // save off this quaternion for analysis next frame\r\n    this.lastQuaternion.copy(quaternion)\r\n  }\r\n})","AFRAME.registerGeometry('squatRack', {\r\n\r\n  schema: {\r\n    schema: {\r\n      width: {default: 1},\r\n      depth: {default: 1},\r\n      frontHeight: {default: 2.2},\r\n      rearHeight: {default: 1.8},\r\n      frameWidth: {default: 0.08},\r\n      hookRadiusSmall: {default: 0.02},\r\n      hookRadiusLarge: {default: 0.04},\r\n      hookDepth: {default: 0.08},\r\n      hookHeight: {default: 1.5},\r\n      safetyHeight: {default: 0.75},\r\n      safetyRadius: {default: 0.02},\r\n    },\r\n  },\r\n\r\n  init(data) {\r\n    const geometries = []\r\n    let geometry\r\n\r\n    // Origin of rack is center of rack, at floor level.\r\n\r\n    // post, back left\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.rearHeight, data.frameWidth)\r\n    geometry.translate(-data.width / 2, data.rearHeight / 2, data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, back right\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.rearHeight, data.frameWidth)\r\n    geometry.translate(data.width / 2, data.rearHeight / 2, data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, front left\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.frontHeight, data.frameWidth)\r\n    geometry.translate(-data.width / 2, data.frontHeight / 2, -data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, back right\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.frontHeight, data.frameWidth)\r\n    geometry.translate(data.width / 2, data.frontHeight / 2, -data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // hooks...\r\n    // left hook\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusSmall,\r\n                                          data.hookRadiusSmall,\r\n                                          data.hookDepth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth / 2)\r\n    geometries.push(geometry)\r\n\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusLarge,\r\n                                          data.hookRadiusLarge,\r\n                                          0.01)\r\n                                          geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth)\r\n    geometries.push(geometry)\r\n\r\n    // right hook\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusSmall,\r\n                                          data.hookRadiusSmall,\r\n                                          data.hookDepth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth / 2)\r\n    geometries.push(geometry)\r\n\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusLarge,\r\n                                          data.hookRadiusLarge,\r\n                                          0.01)\r\n                                          geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth)\r\n    geometries.push(geometry)\r\n\r\n    // left safety pin\r\n    geometry = new THREE.CylinderGeometry(data.safetyRadius,\r\n                                          data.safetyRadius,\r\n                                          data.depth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.safetyHeight, 0)\r\n    geometries.push(geometry)\r\n\r\n    // right safety pin\r\n    geometry = new THREE.CylinderGeometry(data.safetyRadius,\r\n                                          data.safetyRadius,\r\n                                          data.depth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.safetyHeight, 0)\r\n    geometries.push(geometry)\r\n\r\n    this.geometry = THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);\r\n  }\r\n\r\n})\r\n\r\nAFRAME.registerComponent('squat-rack', {\r\n\r\n  schema: {\r\n    width: {default: 1},\r\n    depth: {default: 1},\r\n    frontHeight: {default: 2.2},\r\n    rearHeight: {default: 1.8},\r\n    frameWidth: {default: 0.08},\r\n    hookRadiusSmall: {default: 0.02},\r\n    hookRadiusLarge: {default: 0.04},\r\n    hookDepth: {default: 0.08},\r\n    hookHeight: {default: 1.5},\r\n    safetyHeight: {default: 0.75},\r\n    safetyRadius: {default: 0.02},\r\n  },\r\n\r\n  init() {\r\n\r\n    this.el.setAttribute('geometry', {primitive: 'squatRack', \r\n                                      width: this.data.width,\r\n                                      depth: this.data.depth,\r\n                                      frontHeight: this.data.frontHeight,\r\n                                      rearHeight: this.data.rearHeight,\r\n                                      frameWidth: this.data.frameWidth,\r\n                                      hookRadiusSmall: this.data.hookRadiusSmall,\r\n                                      hookRadiusLarge: this.data.hookRadiusLarge,\r\n                                      hookDepth: this.data.hookDepth,\r\n                                      hookHeight: this.data.hookHeight,\r\n                                      safetyHeight: this.data.safetyHeight,\r\n                                      safetyRadius: this.data.safetyRadius})\r\n\r\n    this.el.setAttribute('material', {color: '#333'})\r\n  }\r\n})","// Top-level UI component that manages visibility of other UIs\r\nAFRAME.registerComponent('ui-manager', {\r\n\r\n  init() {\r\n    this.state = {\r\n      calibrated: false,\r\n      inRack: false,\r\n    }\r\n\r\n    this.calibrationComplete = this.calibrationComplete.bind(this)\r\n    this.enteredRack = this.enteredRack.bind(this)\r\n    this.exitedRack = this.exitedRack.bind(this)\r\n    this.el.addEventListener('calibration-complete', this.calibrationComplete)\r\n    this.el.addEventListener('entered-rack', this.enteredRack);\r\n    this.el.addEventListener('exited-rack', this.exitedRack);\r\n\r\n\r\n    this.calibrationUI = document.getElementById('calibration-ui')\r\n    this.insideRackUI = document.getElementById('inside-rack-ui')\r\n    this.outsideRackUI = document.getElementById('outside-rack-ui')\r\n\r\n    this.updateUIs()\r\n  },\r\n\r\n  calibrationComplete() {\r\n    this.state.calibrated = true\r\n    this.updateUIs()\r\n  },\r\n\r\n  enteredRack() {\r\n    this.state.inRack = true\r\n    this.updateUIs()\r\n  },\r\n\r\n  exitedRack() {\r\n    this.state.inRack = false\r\n    this.updateUIs()\r\n  },\r\n\r\n  updateUIs() {\r\n\r\n    updateVisibility = (el, visible) => {\r\n      if (el && el.object3D) {\r\n        el.object3D.visible = visible\r\n      }\r\n    }\r\n\r\n    if (this.state.calibrated) {\r\n\r\n      if (this.state.inRack) {\r\n        updateVisibility(this.calibrationUI, false)\r\n        updateVisibility(this.insideRackUI, true)\r\n        updateVisibility(this.outsideRackUI, false)\r\n      }\r\n      else {\r\n        updateVisibility(this.calibrationUI, false)\r\n        updateVisibility(this.insideRackUI, false)\r\n        updateVisibility(this.outsideRackUI, true)\r\n      }\r\n    }\r\n    else {\r\n      updateVisibility(this.calibrationUI, true)\r\n      updateVisibility(this.insideRackUI, false)\r\n      updateVisibility(this.outsideRackUI, false)\r\n    }\r\n  }\r\n})","// Configure on scene.\r\n\r\n// Updates UI component(s) to display rep status\r\n\r\nAFRAME.registerComponent('ui-updater', {\r\n\r\n  init() {\r\n\r\n    this.reachedHooks = this.reachedHooks.bind(this)\r\n    this.leftHooks = this.leftHooks.bind(this)\r\n    this.shoulderedBar = this.shoulderedBar.bind(this)\r\n    this.returnedBar = this.returnedBar.bind(this)\r\n    this.hitTop = this.hitTop.bind(this)\r\n    this.loweredFromTop = this.loweredFromTop.bind(this)\r\n    this.hitTargetDepth = this.hitTargetDepth.bind(this)\r\n    this.upwardsFromTargetDepth = this.upwardsFromTargetDepth.bind(this)\r\n    this.belowSafetyPins = this.belowSafetyPins.bind(this)\r\n    this.bailedOut = this.bailedOut.bind(this)\r\n\r\n    this.el.addEventListener('reached-hooks', this.reachedHooks);\r\n    this.el.addEventListener('left-hooks', this.leftHooks);\r\n    this.el.addEventListener('shouldered-bar', this.shoulderedBar);\r\n    this.el.addEventListener('returned-bar', this.returnedBar);\r\n    this.el.addEventListener('hit-top', this.hitTop);\r\n    this.el.addEventListener('lowered-from-top', this.loweredFromTop);\r\n    this.el.addEventListener('hit-target-depth', this.hitTargetDepth);\r\n    this.el.addEventListener('upwards-from-target-depth', this.upwardsFromTargetDepth);\r\n    this.el.addEventListener('below-safety-pins', this.belowSafetyPins);\r\n    this.el.addEventListener('bailed-out', this.bailedOut);\r\n\r\n    this.state = {\r\n      repPhase: 'none',  // one of: none, ready, down, up, rest\r\n      repsToGo: 0\r\n    }\r\n\r\n    this.insideRackUI = document.querySelector('#inside-rack-ui')\r\n    this.outsideRackUI = document.querySelector('#outside-rack-ui')\r\n\r\n  },\r\n\r\n  remove() {\r\n    this.el.removeEventListener('reached-hooks', this.reachedHooks);\r\n    this.el.removeEventListener('left-hooks', this.leftHooks);\r\n    this.el.removeEventListener('shouldered-bar', this.shoulderedBar);\r\n    this.el.removeEventListener('returned-bar', this.returnedBar);\r\n    this.el.removeEventListener('hit-top', this.hitTop);\r\n    this.el.removeEventListener('lowered-from-top', this.loweredFromTop);\r\n    this.el.removeEventListener('hit-target-depth', this.hitTargetDepth);\r\n    this.el.removeEventListener('upwards-from-target-depth', this.upwardsFromTargetDepth);\r\n    this.el.removeEventListener('below-safety-pins', this.belowSafetyPins);\r\n    this.el.removeEventListener('bailed-out', this.bailedOut);\r\n  },\r\n\r\n  setTargetReps(repCount) {\r\n\r\n    this.state.repsToGo = repCount\r\n    this.insideRackUI.setAttribute('inside-rack-ui', {repsToGo: this.state.repsToGo})\r\n  },\r\n\r\n  repCompleted() {\r\n\r\n    this.state.repsToGo--\r\n    this.insideRackUI.setAttribute('inside-rack-ui', {repsToGo: this.state.repsToGo})\r\n  },\r\n\r\n  reachedHooks() {\r\n\r\n    this.setMessage('Take weight of bar')\r\n  },\r\n\r\n  leftHooks() {\r\n    // no update needed\r\n  },\r\n\r\n  shoulderedBar() {\r\n    this.setMessage('Step Back')\r\n  },\r\n\r\n  returnedBar() {\r\n    this.setMessage('Finished!')\r\n  },\r\n\r\n  setMessage(message) {\r\n    this.insideRackUI.setAttribute('inside-rack-ui', {message: message})\r\n  },\r\n\r\n  hitTop() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.state.repPhase = 'ready'\r\n        this.setMessage('Ready!')\r\n        break\r\n\r\n      case 'down':\r\n        this.state.repPhase = 'rest'\r\n        this.setMessage('Incomplete Rep')\r\n        break\r\n\r\n      case 'up':\r\n        this.state.repPhase = 'rest'\r\n        this.setMessage('Rep Complete')\r\n        this.repCompleted()\r\n        break\r\n\r\n      default: \r\n        console.error(\"Hit Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  loweredFromTop() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.setMessage('Stand Taller before beginning reps')\r\n        break\r\n\r\n      case 'ready':\r\n      case 'rest':\r\n        this.state.repPhase = 'down'\r\n        this.setMessage('Going down...')\r\n        break\r\n\r\n      case 'up':\r\n        this.setMessage('Stand at full height to complete last Rep!')\r\n        break\r\n\r\n      default: \r\n        console.error(\"Lowered From Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n\r\n  },\r\n\r\n  hitTargetDepth() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.setMessage('Stand at full height before beginning reps')\r\n        break\r\n\r\n      case 'down':\r\n        this.setMessage('Hit Depth!')\r\n        this.state.repPhase = 'up'\r\n        break\r\n  \r\n      case 'up':\r\n        this.setMessage('Push up to complete this rep!')\r\n        break\r\n\r\n      default: \r\n        console.error(\"Lowered From Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  upwardsFromTargetDepth() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'up':\r\n        // expected.  No action / state change needed\r\n        break\r\n\r\n      default: \r\n        console.error(\"Lowered From Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  belowSafetyPins() {\r\n\r\n    this.setMessage('Failed set.  Step out of rack and remove weight plates from bar.')\r\n\r\n  },\r\n\r\n  bailedOut() {\r\n    this.setMessage('Failed set.  Step out of rack and remove weight plates from bar.')\r\n  }\r\n})\r\n","AFRAME.registerComponent('vertical-controls', {\r\n\r\n  init() {\r\n\r\n    this.verticalVelocity = 0\r\n    this.verticalAcceleration = 0\r\n\r\n    this.keyDown = this.keyDown.bind(this)\r\n    this.keyUp = this.keyUp.bind(this)\r\n\r\n    window.addEventListener('keydown', this.keyDown)\r\n    window.addEventListener('keyup', this.keyUp)\r\n  },\r\n\r\n  keyDown(e) {\r\n\r\n    if (e.key === \"o\") {\r\n      this.verticalAcceleration += 2\r\n    }\r\n\r\n    if (e.key === \"k\") {\r\n      this.verticalAcceleration = -2\r\n    }\r\n  },\r\n\r\n  keyUp(e) {\r\n    \r\n    if (e.key === \"o\" || e.key === \"k\") {\r\n      this.verticalVelocity = 0\r\n      this.verticalAcceleration = 0\r\n    }\r\n  },\r\n\r\n  tick(t, dt) {\r\n\r\n    velDelta = dt * this.verticalAcceleration / 1000\r\n    this.verticalVelocity += velDelta\r\n    if (this.verticalVelocity > 1) this.verticalVelocity = 1\r\n    if (this.verticalVelocity < -1) this.verticalVelocity = -1\r\n\r\n    yDelta = dt * this.verticalVelocity / 1000\r\n    this.el.object3D.position.y += yDelta\r\n  }\r\n})","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/* global AFRAME, THREE */\r\n\r\nrequire('./src/bar-position.js')\r\nrequire('./src/bar-monitor.js')\r\nrequire('./src/in-rack-ui.js')\r\nrequire('./src/ui-updater.js')\r\nrequire('./src/squat-rack.js')\r\nrequire('./src/vertical-controls.js')\r\nrequire('./src/nod-shake.js')\r\nrequire('./src/calibration-flow')\r\nrequire('./src/ui-manager')"],"names":["root","factory","exports","module","define","amd","a","i","self","AFRAME","registerComponent","dependencies","schema","hookPosition","type","default","x","y","z","topHeight","targetDepth","safetyPinHeight","rackWidth","rackDepth","init","this","state","insideRack","lifterAtHooks","barOnShoulders","atTop","belowDepth","belowSafetyPins","isInsideRack","barPosition","insideLR","insideFB","Math","abs","data","zOffset","checkIfInsideRack","el","emit","isAtHooks","atHooksLR","atHooksFB","checkIfAtHooks","isAtTop","checkIfAtTop","isBelowDepth","checkIfBelowDepth","isBelowSafetyPins","checkIfBelowSafetyPins","tick","sceneEl","components","cameraPosition","THREE","Vector3","cameraQuaternion","Quaternion","tempQuaternion","rackEl","document","querySelector","rack","object3D","rackInverseTransform","Matrix4","updateWorldMatrix","copy","matrixWorld","invert","barOffset","set","getCameraAndBarPosition","position","quaternion","camera","getWorldPosition","getWorldQuaternion","applyMatrix4","setFromRotationMatrix","multiply","addVectors","update","calibrationUIMessages","start","hooks","top","depth","safety","review","done","calibrationUIPositions","nodEvent","bind","shakeEvent","addEventListener","stage","saving","deleting","calibrationUI","getElementById","updateUI","remove","removeEventListener","beginCalibrationProcess","visible","endCalibrationProcess","getBarPosition","moveToStage","setTimeout","moveBackToStage","pos","setAttribute","ypos","console","error","message","circle","createElement","appendChild","text","color","width","wrapCount","align","string","repsToGo","nodSensitivity","shakeSensitivity","debug","lastQuaternion","deltaQuaternion","firstFrame","cumRotNod","cumRotShake","debugDisplayCounter","display","parentNode","removeChild","primeDebugReset","delta","premultiply","normalize","sqrt","w","angle","acos","absAngle","log","registerGeometry","frontHeight","rearHeight","frameWidth","hookRadiusSmall","hookRadiusLarge","hookDepth","hookHeight","safetyHeight","safetyRadius","geometries","geometry","BoxGeometry","translate","push","CylinderGeometry","rotateX","PI","BufferGeometryUtils","mergeBufferGeometries","primitive","calibrated","inRack","calibrationComplete","enteredRack","exitedRack","insideRackUI","outsideRackUI","updateUIs","updateVisibility","reachedHooks","leftHooks","shoulderedBar","returnedBar","hitTop","loweredFromTop","hitTargetDepth","upwardsFromTargetDepth","bailedOut","repPhase","setTargetReps","repCount","repCompleted","setMessage","verticalVelocity","verticalAcceleration","keyDown","keyUp","window","e","key","t","dt","velDelta","yDelta","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__"],"sourceRoot":""}