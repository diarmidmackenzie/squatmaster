{"version":3,"file":"squatmaster.min.js","mappings":"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","sources":["webpack://squatmaster/webpack/universalModuleDefinition","webpack://squatmaster/./node_modules/aframe-polygon-wireframe/index.js","webpack://squatmaster/./src/bar-monitor.js","webpack://squatmaster/./src/bar-position.js","webpack://squatmaster/./src/calibration-flow.js","webpack://squatmaster/./src/in-rack-ui.js","webpack://squatmaster/./src/squat-rack.js","webpack://squatmaster/./src/ui-manager.js","webpack://squatmaster/./src/ui-updater.js","webpack://squatmaster/./src/vertical-controls.js","webpack://squatmaster/webpack/bootstrap","webpack://squatmaster/./index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, () => {\nreturn ","AFRAME.registerComponent(\"polygon-wireframe\", {\r\n\r\n    schema: {\r\n        color: { type: 'color', default: 'grey' },\r\n        opacity: { type: 'number', default: 1 },\r\n        hiddenOpacity: { type: 'number', default: 0 },\r\n        dashed: { type: 'boolean', default: false },\r\n        dashSize: { type: 'number', default: 3 },\r\n        gapSize: { type: 'number', default: 1 },\r\n        dashScale: { type: 'number', default: 30 },\r\n    },\r\n\r\n    init() {\r\n\r\n      this.updateGeometry = this.updateGeometry.bind(this)\r\n      this.el.addEventListener('object3dset', this.updateGeometry)\r\n      if (this.el.getObject3D('mesh')) {\r\n        this.updateGeometry()\r\n      }\r\n    },\r\n\r\n    updateGeometry() {\r\n\r\n      const baseGeometry = this.el.getObject3D('mesh').geometry\r\n      if (!baseGeometry) {\r\n        return\r\n      }\r\n\r\n      if (this.edges) {\r\n        this.edges.dispose()\r\n      }\r\n\r\n      this.edges = new THREE.EdgesGeometry(baseGeometry);\r\n      this.update()\r\n    },\r\n\r\n    update() {\r\n\r\n      const oldMaterial = this.material\r\n      const oldLine = this.line\r\n      const oldHiddenMaterial = this.hiddenMaterial\r\n      const oldHiddenLine = this.hiddenLine\r\n\r\n      const data = this.data\r\n\r\n      this.material = this.createLineMaterial(data.color, data.opacity)\r\n\r\n      if (data.hiddenOpacity !== 0 && \r\n          data.hiddenOpacity !== data.opacity) {\r\n        // separate material needed for hidden parts\r\n        this.hiddenMaterial = this.createLineMaterial(data.color, data.hiddenOpacity)\r\n\r\n        if (data.hiddenOpacity > data.opacity) {\r\n          console.warn(\"Opacity of hidden parts cannot be higher than the opacity of non-hidden parts\")\r\n          console.warn(\"Wireframe will be rendered with opacity \", data.hiddenOpacity, \" as set on hiddenOpacity property.\")\r\n        }\r\n      }\r\n      else {\r\n        this.hiddenMaterial = null\r\n      }\r\n\r\n      if (data.hiddenOpacity !== 0) {\r\n        const material = this.hiddenMaterial || this.material\r\n        material.depthWrite = false\r\n        material.depthTest = false\r\n        material.toneMapped = false\r\n      }\r\n      \r\n      this.line = new THREE.LineSegments( this.edges, this.material );\r\n      this.line.computeLineDistances();\r\n      this.el.object3D.add( this.line );\r\n\r\n      if (this.hiddenMaterial) {\r\n        this.hiddenLine = new THREE.LineSegments( this.edges, this.hiddenMaterial );\r\n        this.hiddenLine.computeLineDistances();\r\n        this.el.object3D.add( this.hiddenLine );\r\n      }\r\n\r\n      this.el.getObject3D('mesh').visible = false;\r\n\r\n      // dispose of any old materials & lines\r\n      function removeLineAndMaterial(line, material) {\r\n        if (line) {\r\n          line.removeFromParent()\r\n        }\r\n        if (material) {\r\n          material.dispose()\r\n        }\r\n      }\r\n      this.removeLineAndMaterial(oldLine, oldMaterial)\r\n      this.removeLineAndMaterial(oldHiddenLine, oldHiddenMaterial)\r\n    },\r\n\r\n    removeLineAndMaterial(line, material) {\r\n      if (line) {\r\n        line.removeFromParent()\r\n      }\r\n      if (material) {\r\n        material.dispose()\r\n      }\r\n    },\r\n\r\n    createLineMaterial(color, opacity) {\r\n\r\n      const data = this.data\r\n      let material\r\n      if (!data.dashed) {\r\n          material = new THREE.LineBasicMaterial( { color: color } )\r\n      }\r\n      else {\r\n          material = new THREE.LineDashedMaterial( { color: color,\r\n                                                     dashSize: data.dashSize,\r\n                                                     gapSize: data.gapSize,\r\n                                                     scale: data.dashScale } )\r\n      }\r\n      material.opacity = opacity\r\n      if (opacity !== 1) {\r\n        material.transparent = true\r\n      }\r\n\r\n      return material\r\n    },\r\n\r\n    remove() {\r\n\r\n      this.el.removeEventListener('object3dset', this.updateGeometry)\r\n      this.el.getObject3D('mesh').visible = true;\r\n      if (this.edges) {\r\n        this.edges.dispose()\r\n      }\r\n\r\n      this.removeLineAndMaterial(this.line, this.material)\r\n    }\r\n})","// component set on scene.\r\n// Contains configuration of key bar thresholds.\r\n// Monitors bar position and generates events when thresholds are hit.\r\nAFRAME.registerComponent('bar-monitor', {\r\n\r\n  dependencies: ['bar-position'],\r\n\r\n  schema: {\r\n    // Position of bar when on hooks (before the lift begins)\r\n    // Co-ordinates in rack space.\r\n    hookPosition : {type: 'vec3', default: {x: 0, y: 1.5, z: -0.5}},\r\n\r\n    // height of bar when lifter is standing up straight.\r\n    topHeight : {default: 0},\r\n\r\n    // target depth for bar, to achieve parallel thighs.\r\n    targetDepth: {default: 0},\r\n\r\n    // height of the bar when it hits the safety pins.\r\n    safetyPinHeight: {default: 0},\r\n\r\n    // width of rack in meters\r\n    rackWidth: {default: 1},\r\n\r\n    // depth (z-direction) of rack in meters\r\n    rackDepth: {default: 1},\r\n\r\n    // whether to show planes\r\n    showPlanes: {default: true},\r\n\r\n    // opacity of planes (if used)\r\n    opacity: {default: 0.3}\r\n\r\n  },\r\n\r\n  init() {\r\n\r\n    this.state = {\r\n      insideRack : false,\r\n      lifterAtHooks : false,\r\n      barOnShoulders : false,\r\n      atTop : false,\r\n      belowDepth : false,\r\n      belowSafetyPins : false,\r\n    }\r\n   },\r\n\r\n  update() {\r\n    this.deletePlanes()\r\n\r\n    if (this.data.showPlanes) {\r\n      this.createPlanes()\r\n    }\r\n  },\r\n\r\n  createPlanes() {\r\n\r\n    //this.aboveTopPlane = this.createPlane(this.data.topHeight, 'green')\r\n    this.topPlaneUpwards = this.createPlane(this.data.topHeight - 0.05, 'green')\r\n    this.depthPlaneUpwards = this.createPlane(this.data.targetDepth, 'green')\r\n    this.safetyPlaneTop = this.createPlane(this.data.safetyPinHeight, 'orange')\r\n    this.safetyPlaneBottom = this.createPlane(this.data.safetyPinHeight - 0.05, 'red')\r\n  },\r\n\r\n  deletePlanes() {\r\n\r\n    deletePlane = (plane) => {\r\n      if (plane) {\r\n        plane.parentNode.removeChild(plane)\r\n      }\r\n    }\r\n\r\n    deletePlane(this.aboveTopPlane)\r\n    deletePlane(this.topPlaneUpwards)\r\n    deletePlane(this.depthPlaneUpwards)\r\n    deletePlane(this.safetyPlaneTop)\r\n    deletePlane(this.safetyPlaneBottom)\r\n\r\n    this.aboveTopPlane = null\r\n    this.aboveTopPlane = null\r\n    this.topPlaneUpwards = null\r\n    this.depthPlaneUpwards = null\r\n    this.safetyPlaneTop = null\r\n    this.safetyPlaneBottom = null\r\n  },\r\n\r\n  createPlane(height, color) {\r\n    const plane = document.createElement('a-entity')\r\n    plane.setAttribute('plane-visualization', {height: height, color: color})\r\n    \r\n    const rackEl = document.querySelector('#rack')\r\n    rackEl.appendChild(plane)\r\n\r\n    return plane\r\n  },\r\n\r\n  isInsideRack(barPosition) {\r\n\r\n    let insideLR, insideFB\r\n\r\n    if (Math.abs(barPosition.x - this.data.hookPosition.x) < this.data.rackWidth / 2) {\r\n      insideLR = true\r\n    }\r\n\r\n    // zOffset relative to hook Position will be positive (up to rack depth)\r\n    // or very small negative (to 10cm tolerance) when inside the rack.\r\n    const zOffset = barPosition.z - this.data.hookPosition.z\r\n    if ((zOffset) < this.data.rackDepth && \r\n        (zOffset) > -0.1) {\r\n      insideFB = true\r\n    }\r\n\r\n    return (insideLR && insideFB)\r\n\r\n  },\r\n\r\n  checkIfInsideRack(barPosition) {\r\n    if (this.isInsideRack(barPosition)) {\r\n\r\n      if (!this.state.insideRack) {\r\n        this.el.emit('entered-rack')\r\n      }\r\n\r\n      this.state.insideRack = true\r\n    }\r\n    else {\r\n      if (this.state.insideRack) {\r\n        this.el.emit('exited-rack')\r\n      }\r\n\r\n      this.state.insideRack = false\r\n    }\r\n\r\n    return this.state.insideRack\r\n  },\r\n\r\n  isAtHooks(barPosition) {\r\n\r\n    let atHooksLR, atHooksFB\r\n\r\n    // for L-R, anywhere in rack will do.\r\n    if (Math.abs(barPosition.x - this.data.hookPosition.x) < this.data.rackWidth / 2) {\r\n      atHooksLR = true\r\n    }\r\n\r\n    // 10cm tolerance for Front-Back.\r\n\r\n    // Note: user can subvert logic by bringing in bar very close to pins, then lowering directly in front of pins.\r\n    // App will assume bar has been returned to rack, when in fact it's still on users' shoulders.\r\n    // This behaviour seems really unlikely to happen, unless user is deliberatly trying to subvert the app...\r\n\r\n    // Not sure we can do any better without introducing risk of false negatives when bar\r\n    // is legitimately returned to the hooks.\r\n    if (Math.abs(this.data.hookPosition.z - barPosition.z) < 0.05) {\r\n      atHooksFB = true\r\n    }\r\n\r\n    return atHooksLR && atHooksFB\r\n  },\r\n\r\n  checkIfAtHooks(barPosition) {\r\n\r\n    if (this.isAtHooks(barPosition)) {\r\n      if (!this.state.lifterAtHooks) {\r\n        this.el.emit('reached-hooks')\r\n      }\r\n      this.state.lifterAtHooks = true\r\n    }\r\n    else {\r\n      if (this.state.lifterAtHooks) {\r\n        // lifter leaving hooks.\r\n        // may or may not have bar on shoulders.  Determine based on y position.\r\n\r\n        if (barPosition.y > this.data.hookPosition.y) {\r\n          // bar above hooks - must be on shoulders.\r\n\r\n          if (!this.state.barOnShoulders) {\r\n\r\n            this.el.emit('shouldered-bar')\r\n          }\r\n          \r\n          this.state.barOnShoulders = true\r\n        }\r\n        else {\r\n          // bar below hooks - must have deposited it back on the hooks.\r\n\r\n          if (this.state.barOnShoulders) {\r\n\r\n            this.el.emit('returned-bar')\r\n          }\r\n          \r\n          this.state.barOnShoulders = false\r\n        }\r\n\r\n        this.el.emit('left-hooks')\r\n      }\r\n      this.state.lifterAtHooks = false\r\n    }\r\n\r\n    return this.state.lifterAtHooks\r\n  },\r\n\r\n  isAtTop(barPosition) {\r\n\r\n    // 5cm tolerance.  Anything over top is considered at top.\r\n    if (this.data.topHeight - barPosition.y < 0.05) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfAtTop(barPosition) {\r\n    if (this.isAtTop(barPosition)) {\r\n\r\n      if (!this.state.atTop) {\r\n        this.el.emit('hit-top')\r\n      }\r\n\r\n      this.state.atTop = true\r\n    }\r\n    else {\r\n      if (this.state.atTop) {\r\n        this.el.emit('lowered-from-top')\r\n      }\r\n\r\n      this.state.atTop = false\r\n    }\r\n\r\n    return this.state.atTop\r\n  },\r\n\r\n  isBelowDepth(barPosition) {\r\n\r\n    // Below target depth.  No tolerance - must pass target depth.\r\n    if (barPosition.y < this.data.targetDepth) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfBelowDepth(barPosition) {\r\n    if (this.isBelowDepth(barPosition)) {\r\n\r\n      if (!this.state.belowDepth) {\r\n        this.el.emit('hit-target-depth')\r\n      }\r\n\r\n      this.state.belowDepth = true\r\n    }\r\n    else {\r\n      if (this.state.belowDepth) {\r\n        this.el.emit('upwards-from-target-depth')\r\n      }\r\n\r\n      this.state.belowDepth = false\r\n    }\r\n\r\n    return this.state.belowDepth\r\n  },\r\n\r\n  isBelowSafetyPins(barPosition) {\r\n\r\n    // Below safety pins\r\n    // wait until fully 5cm below, to be sure lifter is bailing out, not just performing a deep rep.\r\n    if (barPosition.y < (this.data.safetyPinHeight - 0.05)) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfBelowSafetyPins(barPosition) {\r\n    if (this.isBelowSafetyPins(barPosition)) {\r\n\r\n      if (!this.state.belowSafetyPins) {\r\n        this.el.emit('below-safety-pins')\r\n      }\r\n\r\n      this.state.belowSafetyPins = true\r\n    }\r\n    else {\r\n      if (this.state.belowSafetyPins) {\r\n        this.el.emit('bailed-out')\r\n\r\n        // following bail-out, bar is no longer on the shoulders.\r\n        this.state.barOnShoulders = false\r\n      }\r\n\r\n      this.state.belowSafetyPins = false\r\n    }\r\n\r\n    return this.state.belowSafetyPins\r\n  },\r\n\r\n  tick() {\r\n    barPosition = this.el.sceneEl.components['bar-position'].barPosition\r\n\r\n    // is the lifter inside the rack?\r\n    const insideRack = this.checkIfInsideRack(barPosition)\r\n\r\n    // if not inside rack, nothing else can happen.\r\n    if (!insideRack) return\r\n\r\n    // is the lifter at the pins (likely either taking on, or dropping off the bar?)\r\n    // This also updates state about whether or not the lifter has the bar on their shoulders.\r\n    this.checkIfAtHooks(barPosition)\r\n\r\n    // is the lifter at the top of a rep?\r\n    this.checkIfAtTop(barPosition)\r\n\r\n    // has the lifter gone below target depth?\r\n    this.checkIfBelowDepth(barPosition)\r\n\r\n    // has the lifter bailed out on the safety pins?\r\n    this.checkIfBelowSafetyPins(barPosition)\r\n\r\n  }\r\n})\r\n\r\nAFRAME.registerComponent('plane-visualization', {\r\n\r\n  schema: {\r\n    height: {default: 0},\r\n    color: {default: 'red'}\r\n  },\r\n\r\n  init() {\r\n\r\n    const {height, color} = this.data\r\n\r\n    this.createRing(height, color, 0.8, 0.5)\r\n    this.createRing(height, color, 1.2, 1)\r\n\r\n  },\r\n\r\n  createRing(height, color, radius, opacity) {\r\n\r\n    const ring = document.createElement('a-torus')\r\n    ring.object3D.rotation.x = Math.PI / 2\r\n    ring.object3D.position.y = height\r\n    ring.setAttribute('radius', radius)\r\n    ring.setAttribute('radius-tubular', 0.001)\r\n    ring.setAttribute('segments-tubular', 128)\r\n    ring.setAttribute('material', {color: color,\r\n                                   opacity: opacity,\r\n                                   transparent: (opacity < 1)})\r\n    this.el.appendChild(ring)\r\n\r\n    return ring\r\n  }\r\n})","\r\n// Component set on scene.\r\n// Tracks camera and maintains public data for\r\n// - cameraPostion\r\n// - cameraQuaternion\r\n// - barPosition\r\n// All as measured in rack space.\r\n\r\n// No implemented support for switching camera / multi-camera\r\n\r\n// as far as possible, we try to work in rack space.\r\n// In rack space, x is left-right and z is forward (+ve) and backward (-ve)\r\n// Typically this will not align with world space.\r\n\r\nAFRAME.registerComponent('bar-position', {\r\n  \r\n  init() {\r\n    // called once when component is added to an entity\r\n\r\n    // camera position & quaternion in Rack Space.  Updated every tick.\r\n    this.cameraPosition = new THREE.Vector3()\r\n    this.cameraQuaternion = new THREE.Quaternion()\r\n\r\n    // for working\r\n    this.tempQuaternion = new THREE.Quaternion()\r\n\r\n    // world position of rack.\r\n    this.rackEl = document.querySelector('#rack')\r\n    rack = this.rackEl.object3D\r\n    this.rackInverseTransform = new THREE.Matrix4()\r\n    rack.updateWorldMatrix()\r\n    this.rackInverseTransform.copy(rack.matrixWorld)\r\n    this.rackInverseTransform.invert()\r\n\r\n    // now if I apply rackInverseTransform to an object in worldSpace, I get it's transform in rack space.\r\n    // vector to track bar position, in rack-space.\r\n    // Public.\r\n    this.barPosition = new THREE.Vector3()\r\n    \r\n    this.barOffset = new THREE.Vector3()\r\n    // Potential for bar offset, but setting to zero for now.\r\n    // Plane visualization doesn't accoutn for this and would need to be updated if we added this back in.\r\n    //this.barOffset.set(0, -0.1, -0.2)\r\n    this.getCameraAndBarPosition()\r\n    \r\n  },\r\n\r\n  getCameraAndBarPosition() {\r\n\r\n    const position = this.cameraPosition\r\n    const quaternion = this.cameraQuaternion\r\n\r\n    this.el.sceneEl.camera.getWorldPosition(position);\r\n    this.el.sceneEl.camera.getWorldQuaternion(quaternion);\r\n\r\n    const rackInverseTransform = this.rackInverseTransform\r\n    position.applyMatrix4(rackInverseTransform)\r\n    this.tempQuaternion.setFromRotationMatrix(rackInverseTransform)\r\n    quaternion.multiply(this.tempQuaternion)\r\n\r\n    this.barPosition.addVectors(this.cameraPosition, this.barOffset)\r\n\r\n    // bar quaternion is assumed to always be the identity\r\n    // bar in standard orientation across the rack.\r\n  },\r\n\r\n  update() {\r\n    // called whenever component properties are updated\r\n\r\n  },\r\n\r\n  tick() {\r\n\r\n    this.getCameraAndBarPosition()\r\n  }\r\n})","const calibrationUIImages = {\r\n  start: '#calibration0',\r\n  bar: '#calibration1',\r\n  hooks: '#calibration2',\r\n  top: '#calibration3', \r\n  depth: '#calibration4',\r\n  safety: '#calibration5',\r\n  review: '#calibration6',\r\n  done: '#calibration7',\r\n}\r\n\r\nconst calibrationUISounds = {\r\n  start: '#sound1',\r\n  bar: '#sound4',\r\n  hooks: '#sound5',\r\n  top: '#sound7', \r\n  depth: '#sound8',\r\n  safety: '#sound9',\r\n  review: '#sound10',\r\n  done: '#sound11',\r\n}\r\n\r\nconst calibrationUIFollowOnSounds = {\r\n  start: '#sound2',\r\n  hooks: '#sound6',\r\n  top: '#sound6',\r\n  depth: '#sound6',\r\n  safety: '#sound6',\r\n  done: '#sound12',\r\n}\r\n\r\nconst calibrationUIFollowOnSounds2 = {\r\n  start: '#sound3'\r\n}\r\n\r\nAFRAME.registerComponent('calibration-flow', {\r\n\r\n  dependencies: ['bar-position'],\r\n\r\n  schema: {\r\n    skip: {default: false} // for testing: skip calibration & just set up with some defaults.\r\n  },\r\n\r\n  init() {\r\n\r\n    this.reachedHooks = this.reachedHooks.bind(this)\r\n    this.forwardEvent = this.forwardEvent.bind(this)\r\n    this.backEvent = this.backEvent.bind(this)\r\n    \r\n    this.el.addEventListener('click-forward', this.forwardEvent);\r\n    this.el.addEventListener('click-back', this.backEvent);\r\n    this.el.addEventListener('reached-hooks', this.reachedHooks);\r\n\r\n    // UI state\r\n    this.stage = 'start' // one of: start, hooks, top, depth, safety, review, done\r\n    \r\n    this.calibrationUI = document.getElementById('calibration-ui')\r\n\r\n    this.cameraWorldPosition = new THREE.Vector3()\r\n    this.cameraWorldQuaternion = new THREE.Quaternion()\r\n    this.forwardVector = new THREE.Vector3(0, 0, -1)\r\n    this.directionVector = new THREE.Vector3()\r\n\r\n    this.el.addEventListener('enter-vr', () => {\r\n      this.playSFX('#sfx-welcome')\r\n      setTimeout(() => this.playPrompt(this.stage), 5000)\r\n      \r\n      const video = document.querySelector('#video1')\r\n      if (video) {\r\n        video.play()\r\n      }\r\n    })\r\n\r\n    if (this.data.skip) {\r\n\r\n      this.el.setAttribute('bar-monitor', \r\n                            `topHeight: 1.6;\r\n                             targetDepth: 0.9;\r\n                             safetyPinHeight: 0.75`)\r\n\r\n      this.endCalibrationProcess()\r\n    }\r\n  },\r\n\r\n  update() {\r\n    this.updateUI()\r\n  },\r\n\r\n  remove() {\r\n    this.el.removeEventListener('click-forward', this.forwardEvent);\r\n    this.el.removeEventListener('click-back', this.backEvent);\r\n  },\r\n\r\n  beginCalibrationProcess() {\r\n\r\n    this.stage = 'start'\r\n    this.calibrationUI.object3D.visible = true\r\n    this.updateUI()\r\n\r\n  },\r\n\r\n  endCalibrationProcess() {\r\n    this.calibrationUI.object3D.visible = false\r\n    this.el.emit('calibration-complete')\r\n  },\r\n\r\n  getBarPosition() {\r\n\r\n    const component = this.el.components['bar-position']\r\n    return component.barPosition\r\n  },\r\n\r\n  moveToStage(stage) {\r\n\r\n    this.playPrompt(stage)\r\n    this.stage = stage\r\n    this.updateUI()\r\n  },\r\n\r\n  // equivalent function when moving back a stage...\r\n  moveBackToStage(stage) {\r\n\r\n    this.playPrompt(stage)\r\n    this.stage = stage\r\n    this.updateUI()\r\n  },\r\n\r\n  playPrompt(stage) {\r\n    const origin = document.getElementById('sound-origin')\r\n\r\n    origin.setAttribute('sound', {src: calibrationUISounds[stage], autoplay: true})\r\n    //origin.components.sound.playSound();\r\n\r\n    if (calibrationUIFollowOnSounds[stage]) {\r\n      setTimeout(() => {\r\n        origin.setAttribute('sound', {src: calibrationUIFollowOnSounds[stage], autoplay: true})\r\n        origin.components.sound.playSound();\r\n      }, 2000)\r\n    }\r\n\r\n    if (calibrationUIFollowOnSounds2[stage]) {\r\n      setTimeout(() => {\r\n        origin.setAttribute('sound', {src: calibrationUIFollowOnSounds2[stage], autoplay: true})\r\n        origin.components.sound.playSound();\r\n      }, 5000)\r\n    }\r\n  },\r\n\r\n  playSFX(src) {\r\n    const origin = document.getElementById('sfx-origin')\r\n\r\n    origin.setAttribute('sound', {src: '', autoplay: false})\r\n    origin.setAttribute('sound', {src: src, autoplay: true})\r\n  },\r\n\r\n  reachedHooks() {\r\n\r\n    // special case for step 6 -> 7 transition, based on reaching hooks again,\r\n    // not based on nods...\r\n\r\n    if (this.stage === 'review') {\r\n      this.playSFX('#sfx-interaction')\r\n      this.moveToStage('done')\r\n    }\r\n  },\r\n\r\n  forwardEvent() {\r\n\r\n    let yPos\r\n\r\n    switch (this.stage) {\r\n\r\n      case 'start':\r\n        // At this nod, we set the position of '#rack' to the current headset position (x & z co-ords only)\r\n        const rack = document.querySelector('#rack')\r\n        const position = this.cameraWorldPosition\r\n        const quaternion = this.cameraWorldQuaternion\r\n\r\n        this.el.sceneEl.camera.getWorldPosition(position);\r\n        this.el.sceneEl.camera.getWorldQuaternion(quaternion);\r\n        rack.object3D.position.x = position.x\r\n        rack.object3D.position.y = 0\r\n        rack.object3D.position.z = position.z\r\n\r\n        // rotate forward vector by quaternion, zero out y axis component, then find\r\n        // quaternion that rotates forward to this vector.\r\n        // That's the vector to use for the rack orientation\r\n        const forward = this.forwardVector\r\n        const direction = this.directionVector\r\n        direction.copy(forward)\r\n        direction.applyQuaternion(quaternion)\r\n        direction.y = 0\r\n        direction.normalize()\r\n\r\n        rack.object3D.quaternion.setFromUnitVectors(forward, direction)\r\n\r\n        this.moveToStage('bar')\r\n        this.playSFX('#sfx-interaction')\r\n        break\r\n\r\n      case 'bar':\r\n        // no data to record yet.\r\n        this.moveToStage('hooks')\r\n        this.playSFX('#sfx-interaction')\r\n        break\r\n\r\n      case 'hooks':\r\n        // new Vector3 to ensure update happens.\r\n        const pos = new THREE.Vector3()\r\n        pos.copy(this.getBarPosition())\r\n        this.el.setAttribute('bar-monitor', {hookPosition: pos})\r\n        this.moveToStage('top')\r\n\r\n        this.playSFX('#sfx-data-saved')\r\n        break\r\n  \r\n      case 'top':\r\n        ypos = this.getBarPosition().y\r\n        this.el.setAttribute('bar-monitor', {topHeight: ypos})\r\n        this.moveToStage('depth')\r\n        this.playSFX('#sfx-data-saved')\r\n        break\r\n\r\n      case 'depth':\r\n        ypos = this.getBarPosition().y\r\n        this.el.setAttribute('bar-monitor', {targetDepth: ypos})\r\n        this.moveToStage('safety')\r\n        this.playSFX('#sfx-data-saved')\r\n        break\r\n\r\n      case 'safety':\r\n        ypos = this.getBarPosition().y\r\n        this.el.setAttribute('bar-monitor', {safetyPinHeight: ypos})\r\n        this.moveToStage('review')\r\n        this.playSFX('#sfx-data-saved')\r\n        break\r\n\r\n      case 'review':\r\n        // No action\r\n        // Final move step 6 -> 7 is based on 'reached-hooks' event\r\n        // but can also use forward button\r\n        this.moveToStage('done')\r\n        this.playSFX('#sfx-interaction')\r\n        break\r\n\r\n      case 'done':\r\n        this.endCalibrationProcess()\r\n        this.playSFX('#sfx-interaction')\r\n        break\r\n\r\n      default:\r\n        console.error(\"Hit Forward in unexpected state: \", this.stage)\r\n        break\r\n    }\r\n  },\r\n\r\n  backEvent() {\r\n\r\n    switch (this.stage) {\r\n\r\n      case 'start':\r\n        // no effect\r\n        break\r\n\r\n      case 'bar':\r\n        this.moveBackToStage('start')\r\n        this.playSFX('#sfx-data-reoved')\r\n        break\r\n\r\n      case 'hooks':\r\n        this.moveBackToStage('bar')\r\n        this.playSFX('#sfx-data-reoved')\r\n        break\r\n  \r\n      case 'top':\r\n        this.moveBackToStage('hooks')\r\n        this.playSFX('#sfx-data-reoved')\r\n        break\r\n\r\n      case 'depth':\r\n        this.moveBackToStage('top')\r\n        this.playSFX('#sfx-data-reoved')\r\n        break\r\n\r\n      case 'safety':\r\n        this.moveBackToStage('depth')\r\n        this.playSFX('#sfx-data-reoved')\r\n        break\r\n\r\n      case 'review':\r\n        this.moveBackToStage('safety')\r\n        this.playSFX('#sfx-data-reoved')\r\n        break\r\n\r\n      case 'done':\r\n        this.moveBackToStage('review')\r\n        this.playSFX('#sfx-data-reoved')\r\n        break\r\n         \r\n      default:\r\n        console.error(\"Hit Back in unexpected state: \", this.stage)\r\n        break\r\n    }\r\n  },\r\n\r\n  updateUI() {\r\n\r\n    const forward = true // always a forward button\r\n    const back = (this.stage !== 'start')\r\n\r\n    this.calibrationUI.setAttribute('calibration-ui',\r\n                                     {saving: this.saving,\r\n                                      deleting: this.deleting,\r\n                                      forwardButton: forward,\r\n                                      backButton: back,\r\n                                      imageSelector: calibrationUIImages[this.stage]})\r\n  }\r\n})\r\n\r\nAFRAME.registerComponent('calibration-ui', {\r\n\r\n  schema: {\r\n    imageSelector: {type: 'string'},\r\n    fowardButton: {default: false}, \r\n    backButton: {default: false}\r\n  },\r\n\r\n  init() {\r\n    this.circle = document.createElement('a-entity')\r\n    this.circle.setAttribute('geometry', 'primitive: circle; radius: 1; segments: 128')\r\n    this.circle.setAttribute('material', 'color: white; opacity: 0.8; transparent: true')\r\n    this.el.appendChild(this.circle)\r\n  },\r\n\r\n  update() {\r\n\r\n    this.deleteImage()\r\n    if (this.data.imageSelector) {\r\n   \r\n      this.createImage(this.circle, this.data.imageSelector, 2)\r\n    }\r\n\r\n    this.deleteButtons() \r\n    this.createButtons()\r\n  },\r\n\r\n  createButtons() {\r\n\r\n    if (this.data.forwardButton && !this.data.backButton) {\r\n      this.forwardButton = this.createButton(0, -1, '#check', 'click-forward')\r\n    }\r\n\r\n    if (!this.data.forwardButton && this.data.backButton) {\r\n      this.backButton = this.createButton(0, -1, '#cross', 'click-back')\r\n    }\r\n\r\n    if (this.data.forwardButton && this.data.backButton) {\r\n      this.forwardButton = this.createButton(0.4, -1, '#check', 'click-forward')\r\n      this.backButton = this.createButton(-0.4, -1, '#cross', 'click-back')\r\n    }\r\n  },\r\n\r\n  createButton(x, y, imageSrc, eventName) {\r\n\r\n    button = document.createElement('a-entity')\r\n    button.object3D.position.x = x\r\n    button.object3D.position.y = y\r\n    button.object3D.position.z = 0.001\r\n    button.setAttribute('animated-button', {imageSrc: imageSrc, eventName: eventName})\r\n    this.circle.appendChild(button)\r\n\r\n    return button\r\n  },\r\n\r\n  deleteButtons() {\r\n\r\n    deleteButton = (el) => {\r\n      if (el && el.parentNode) {\r\n        el.parentNode.removeChild(el)\r\n      }\r\n    }\r\n    deleteButton(this.forwardButton)\r\n    deleteButton(this.backButton)\r\n    this.forwardButton = null\r\n    this.backButton = null\r\n  },\r\n\r\n  createImage(parent, src, dimension) {\r\n\r\n    this.image = document.createElement('a-image')\r\n    this.image.setAttribute('alpha-test', 0.1)\r\n    this.image.setAttribute('width', dimension)\r\n    this.image.setAttribute('height', dimension)\r\n    this.image.setAttribute('transparent', true)\r\n    this.image.object3D.position.z = 0.001\r\n    this.image.setAttribute('src', src)\r\n    parent.appendChild(this.image)\r\n\r\n  },\r\n\r\n  deleteImage() {\r\n\r\n    if (this.image) {\r\n      this.image.parentNode.removeChild(this.image)\r\n      this.image = null\r\n    }\r\n  }\r\n});\r\n\r\nAFRAME.registerComponent('animated-button', {\r\n\r\n  schema: {\r\n    imageSrc : {type: 'string'},\r\n    eventName: {type: 'string'}\r\n  },\r\n\r\n  init() {\r\n\r\n    const button = document.createElement('a-entity')\r\n    button.setAttribute('geometry', 'primitive: circle; radius: 0.28; segments: 128')\r\n    button.setAttribute('material', 'color: white; shader: flat')\r\n    button.classList.add('clickable');\r\n    this.el.appendChild(button)\r\n  \r\n    const ring = document.createElement('a-ring')\r\n    ring.setAttribute('radius-inner', 0.28)\r\n    ring.setAttribute('radius-outer', 0.29)\r\n    ring.setAttribute('segments-theta', 128)\r\n    ring.setAttribute('segments-phi', 1)\r\n    ring.setAttribute('material', 'color: grey; shader: flat')\r\n    ring.object3D.position.z = 0.001\r\n    button.appendChild(ring)\r\n  \r\n    this.createImage(button, this.data.imageSrc, 0.3)\r\n  \r\n    const animatedRing = document.createElement('a-ring')\r\n    animatedRing.setAttribute('radius-inner', 0.25)\r\n    animatedRing.setAttribute('radius-outer', 0.32)\r\n    animatedRing.setAttribute('segments-theta', 128)\r\n    animatedRing.setAttribute('segments-phi', 1)\r\n    animatedRing.setAttribute('theta-start', 90)\r\n    animatedRing.setAttribute('theta-length', 0)\r\n    animatedRing.setAttribute('scale', '-1 1 1')\r\n    animatedRing.setAttribute('material', 'color: grey; shader: flat')\r\n  \r\n    animatedRing.object3D.position.z = 0.001\r\n    ring.appendChild(animatedRing)\r\n  \r\n    button.addEventListener('fusing', () => {\r\n      animatedRing.setAttribute('animation', {property: 'geometry.thetaLength',\r\n                                              from: 0,\r\n                                              to: 360,\r\n                                              dur: 1150,\r\n                                              easing: 'easeInQuad'})\r\n    })\r\n  \r\n    button.addEventListener('mouseleave', () => {\r\n      animatedRing.removeAttribute('animation')\r\n      animatedRing.setAttribute('geometry', 'thetaLength: 0')\r\n    })\r\n  \r\n    button.addEventListener('click', () => {\r\n      this.el.sceneEl.emit(this.data.eventName)\r\n    })\r\n  },\r\n\r\n  createImage(parent, src, dimension) {\r\n\r\n    this.image = document.createElement('a-image')\r\n    this.image.setAttribute('alpha-test', 0.1)\r\n    this.image.setAttribute('width', dimension)\r\n    this.image.setAttribute('height', dimension)\r\n    this.image.setAttribute('transparent', true)\r\n    this.image.object3D.position.z = 0.001\r\n    this.image.setAttribute('src', src)\r\n    parent.appendChild(this.image)\r\n\r\n  }\r\n\r\n})\r\n\r\n","AFRAME.registerComponent('inside-rack-ui', {\r\n\r\n  schema: {\r\n    totalReps: {default: 5},\r\n    repsToGo: {default: 5},\r\n    width: {default: 4},\r\n    message: {default: ''}\r\n  },\r\n\r\n  init() {\r\n\r\n    this.reps = []\r\n\r\n    for (let ii = 0; ii < this.data.totalReps; ii++) {\r\n      const rep = document.createElement('a-entity')\r\n      rep.setAttribute('rep-report', {repNumber: ii})\r\n      const reps = this.data.totalReps\r\n      rep.object3D.position.x = (ii - (reps - 1) / 2) * (this.data.width / this.data.totalReps)\r\n      this.el.appendChild(rep)\r\n      this.reps.push(rep)\r\n    }\r\n\r\n    this.repReport = this.repReport.bind(this)\r\n\r\n    this.el.sceneEl.addEventListener('rep-report', this.repReport)\r\n\r\n  },\r\n\r\n  repReport(e) {\r\n\r\n    const data = e.detail\r\n    const {repNumber, completed, failed} = data\r\n\r\n    console.log(\"Rep Report\", data)\r\n\r\n    const rep = this.reps[repNumber]\r\n\r\n    if (!rep) return // user doing more reps than specified!  We don't report them.\r\n\r\n    let status\r\n\r\n    if (completed) {\r\n      status = failed ? 'failed' : 'done'\r\n    }\r\n    else {\r\n      status = 'doing'\r\n    }\r\n    rep.setAttribute('rep-report', {repNumber: repNumber,\r\n                                    status: status,\r\n                                    restPrior: data.restPrior / 1000, // msecs -> secs\r\n                                    timeDown: data.timeDown / 1000, // msecs -> secs\r\n                                    depth: -data.depth * 100, // m -> cm, flip sign.\r\n                                    timeUp: data.timeUp / 1000, // msecs -> secs\r\n                                    turnSpeed: data.turnSpeed,\r\n                                    daviationLR: data.deviationLR, \r\n                                    deviationFB: data.deviationFB})\r\n  }\r\n});\r\n\r\nconst reportStats = [\r\n  {key: 'restPrior', label: 'Rest', units: 's'},\r\n  {key: 'timeDown', label: 'Rest', units: 's'},\r\n  {key: 'depth', label: 'Rest', units: 'cm'},\r\n  {key: 'timeUp', label: 'Rest', units: 's'}\r\n]\r\n\r\nAFRAME.registerComponent('rep-report', {\r\n  schema: {\r\n    repNumber: { type: 'number'},\r\n    status: { type: 'string', default: 'todo'}, // one of: todo, doing, done, failed\r\n    restPrior: {type: 'number'},\r\n    timeDown: {type: 'number'},\r\n    depth: {type: 'number'},\r\n    timeUp: {type: 'number'},\r\n    turnSpeed: {type: 'number'},\r\n    deviationLR: {type: 'number'},\r\n    deviationFB: {type: 'number'}\r\n  }, \r\n\r\n  init() {\r\n\r\n    this.circle = document.createElement('a-circle')\r\n    this.circle.setAttribute('radius', 0.3)\r\n    this.circle.setAttribute('material', {opacity: 0.8, transparent: true})\r\n    this.circle.object3D.position.y = 0.5\r\n    this.el.appendChild(this.circle)\r\n\r\n    this.number = document.createElement('a-entity')\r\n    this.number.setAttribute('text', {color: 'black',\r\n                                      wrapCount: 5,\r\n                                      value: this.data.repNumber + 1,\r\n                                      align: 'center'})\r\n    this.circle.appendChild(this.number)\r\n\r\n    this.childStats = []\r\n  },\r\n\r\n  update() {\r\n\r\n    this.deleteImage()\r\n\r\n    let imgSrc\r\n    const status = this.data.status\r\n    if (status === 'done') {\r\n      imgSrc = '#check'\r\n    }\r\n    if (status === 'failed') {\r\n      imgSrc = '#cross'\r\n    }\r\n    if (imgSrc) {\r\n      this.createImage(this.circle, imgSrc, 0.4)\r\n    }\r\n\r\n    if (status === 'todo' || status === 'doing') {\r\n      this.number.object3D.visible = true\r\n    }\r\n    else {\r\n      this.number.object3D.visible = false\r\n    }\r\n\r\n    this.deleteReportStats()\r\n\r\n    reportStats.forEach((stat, index) => {\r\n      const {key, units} = stat\r\n\r\n      if (this.data[key]) {\r\n        const child = document.createElement('a-entity')\r\n        child.setAttribute('rep-report-stat', {\r\n          value: this.data[key],\r\n          ypos: -0.2 - (index * 0.7),\r\n          units: units\r\n        })\r\n        this.el.appendChild(child)\r\n        this.childStats.push(child)\r\n      }\r\n    })\r\n  },\r\n\r\n  deleteReportStats() {\r\n    this.childStats.forEach((el) => {\r\n      el.parentNode.removeChild(el)\r\n    })\r\n    this.childStats = []\r\n  },\r\n\r\n  createImage(parent, src, dimension) {\r\n\r\n    this.image = document.createElement('a-image')\r\n    this.image.setAttribute('alpha-test', 0.1)\r\n    this.image.setAttribute('width', dimension)\r\n    this.image.setAttribute('height', dimension)\r\n    this.image.setAttribute('transparent', true)\r\n    this.image.object3D.position.z = 0.001\r\n    this.image.setAttribute('src', src)\r\n    parent.appendChild(this.image)\r\n\r\n  },\r\n\r\n  deleteImage() {\r\n\r\n    if (this.image) {\r\n      this.image.parentNode.removeChild(this.image)\r\n      this.image = null\r\n    }\r\n  }\r\n})\r\n\r\n\r\nAFRAME.registerComponent('rep-report-stat', {\r\n  schema: {\r\n    value: { type: 'number'},\r\n    ypos: {type: 'number'},\r\n    units: {type: 'string'}\r\n  }, \r\n\r\n  init() {\r\n\r\n    this.circle = document.createElement('a-circle')\r\n    this.circle.setAttribute('radius', 0.3)\r\n    this.circle.setAttribute('material', {opacity: 0.8, transparent: true, color: 'white'})\r\n    this.circle.object3D.position.y = this.data.ypos\r\n    this.el.appendChild(this.circle)\r\n\r\n    this.number = document.createElement('a-entity')\r\n\r\n    this.circle.appendChild(this.number)\r\n  },\r\n\r\n  update() {\r\n    const numberText = this.data.value.toFixed(1) + this.data.units\r\n    this.number.removeAttribute('text')\r\n    this.number.setAttribute('text', {color: 'black',\r\n                                      wrapCount: 10,\r\n                                      value: numberText,\r\n                                      align: 'center'})\r\n    \r\n    if (this.data.value < 0) {\r\n      this.circle.setAttribute('material', {color: 'orange'})\r\n    }\r\n    else {\r\n      this.circle.setAttribute('material', {color: 'white'})\r\n    }\r\n  }\r\n})\r\n","AFRAME.registerGeometry('squatRack', {\r\n\r\n  schema: {\r\n    schema: {\r\n      width: {default: 1},\r\n      depth: {default: 1},\r\n      frontHeight: {default: 2.2},\r\n      rearHeight: {default: 1.8},\r\n      frameWidth: {default: 0.08},\r\n      hookRadiusSmall: {default: 0.02},\r\n      hookRadiusLarge: {default: 0.04},\r\n      hookDepth: {default: 0.08},\r\n      hookHeight: {default: 1.5},\r\n      safetyHeight: {default: 0.75},\r\n      safetyRadius: {default: 0.02},\r\n    },\r\n  },\r\n\r\n  init(data) {\r\n    const geometries = []\r\n    let geometry\r\n\r\n    // Origin of rack is center of rack, at floor level.\r\n\r\n    // post, back left\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.rearHeight, data.frameWidth)\r\n    geometry.translate(-data.width / 2, data.rearHeight / 2, data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, back right\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.rearHeight, data.frameWidth)\r\n    geometry.translate(data.width / 2, data.rearHeight / 2, data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, front left\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.frontHeight, data.frameWidth)\r\n    geometry.translate(-data.width / 2, data.frontHeight / 2, -data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, back right\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.frontHeight, data.frameWidth)\r\n    geometry.translate(data.width / 2, data.frontHeight / 2, -data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // hooks...\r\n    // left hook\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusSmall,\r\n                                          data.hookRadiusSmall,\r\n                                          data.hookDepth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth / 2)\r\n    geometries.push(geometry)\r\n\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusLarge,\r\n                                          data.hookRadiusLarge,\r\n                                          0.01)\r\n                                          geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth)\r\n    geometries.push(geometry)\r\n\r\n    // right hook\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusSmall,\r\n                                          data.hookRadiusSmall,\r\n                                          data.hookDepth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth / 2)\r\n    geometries.push(geometry)\r\n\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusLarge,\r\n                                          data.hookRadiusLarge,\r\n                                          0.01)\r\n                                          geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth)\r\n    geometries.push(geometry)\r\n\r\n    // left safety pin\r\n    geometry = new THREE.CylinderGeometry(data.safetyRadius,\r\n                                          data.safetyRadius,\r\n                                          data.depth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.safetyHeight, 0)\r\n    geometries.push(geometry)\r\n\r\n    // right safety pin\r\n    geometry = new THREE.CylinderGeometry(data.safetyRadius,\r\n                                          data.safetyRadius,\r\n                                          data.depth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.safetyHeight, 0)\r\n    geometries.push(geometry)\r\n\r\n    this.geometry = THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);\r\n  }\r\n\r\n})\r\n\r\nAFRAME.registerComponent('squat-rack', {\r\n\r\n  schema: {\r\n    width: {default: 1},\r\n    depth: {default: 1},\r\n    frontHeight: {default: 2.2},\r\n    rearHeight: {default: 1.8},\r\n    frameWidth: {default: 0.08},\r\n    hookRadiusSmall: {default: 0.02},\r\n    hookRadiusLarge: {default: 0.04},\r\n    hookDepth: {default: 0.08},\r\n    hookHeight: {default: 1.4},\r\n    safetyHeight: {default: 0.65},\r\n    safetyRadius: {default: 0.02},\r\n  },\r\n\r\n  init() {\r\n\r\n    this.el.setAttribute('geometry', {primitive: 'squatRack', \r\n                                      width: this.data.width,\r\n                                      depth: this.data.depth,\r\n                                      frontHeight: this.data.frontHeight,\r\n                                      rearHeight: this.data.rearHeight,\r\n                                      frameWidth: this.data.frameWidth,\r\n                                      hookRadiusSmall: this.data.hookRadiusSmall,\r\n                                      hookRadiusLarge: this.data.hookRadiusLarge,\r\n                                      hookDepth: this.data.hookDepth,\r\n                                      hookHeight: this.data.hookHeight,\r\n                                      safetyHeight: this.data.safetyHeight,\r\n                                      safetyRadius: this.data.safetyRadius})\r\n\r\n    this.el.setAttribute('material', {color: '#333'})\r\n  }\r\n})","// Top-level UI component that manages visibility of other UIs\r\nAFRAME.registerComponent('ui-manager', {\r\n\r\n  init() {\r\n    this.state = {\r\n      calibrated: false,\r\n      inRack: false,\r\n    }\r\n\r\n    this.calibrationComplete = this.calibrationComplete.bind(this)\r\n    this.enteredRack = this.enteredRack.bind(this)\r\n    this.exitedRack = this.exitedRack.bind(this)\r\n    this.el.addEventListener('calibration-complete', this.calibrationComplete)\r\n    this.el.addEventListener('entered-rack', this.enteredRack);\r\n    this.el.addEventListener('exited-rack', this.exitedRack);\r\n\r\n\r\n    this.calibrationUI = document.getElementById('calibration-ui')\r\n    this.insideRackUI = document.getElementById('inside-rack-ui')\r\n    this.outsideRackUI = document.getElementById('outside-rack-ui')\r\n    this.cursor = document.getElementById('cursor')\r\n    this.videoFrame = document.getElementById('video-frame')\r\n\r\n    this.updateUIs()\r\n  },\r\n\r\n  calibrationComplete() {\r\n    this.state.calibrated = true\r\n    this.updateUIs()\r\n  },\r\n\r\n  enteredRack() {\r\n    this.state.inRack = true\r\n    this.updateUIs()\r\n  },\r\n\r\n  exitedRack() {\r\n    this.state.inRack = false\r\n    this.updateUIs()\r\n  },\r\n\r\n  updateUIs() {\r\n\r\n    updateVisibility = (el, visible) => {\r\n      if (el && el.object3D) {\r\n        el.object3D.visible = visible\r\n      }\r\n    }\r\n\r\n    if (this.state.calibrated) {\r\n\r\n      if (this.state.inRack) {\r\n        updateVisibility(this.calibrationUI, false)\r\n        updateVisibility(this.insideRackUI, true)\r\n        updateVisibility(this.outsideRackUI, false)\r\n      }\r\n      else {\r\n        updateVisibility(this.calibrationUI, false)\r\n        updateVisibility(this.insideRackUI, false)\r\n        updateVisibility(this.outsideRackUI, true)\r\n      }\r\n\r\n      updateVisibility(this.cursor, false)\r\n    }\r\n    else {\r\n      updateVisibility(this.calibrationUI, true)\r\n      updateVisibility(this.insideRackUI, false)\r\n      updateVisibility(this.outsideRackUI, false)\r\n      updateVisibility(this.cursor, true)\r\n    }\r\n\r\n    if (this.state.inRack) {\r\n      updateVisibility(this.videoFrame, true)\r\n    }\r\n    else {\r\n      updateVisibility(this.videoFrame, false)\r\n    }\r\n  }\r\n})","// Configure on scene.\r\n\r\n// Updates UI component(s) to display rep status\r\n\r\nAFRAME.registerComponent('ui-updater', {\r\n\r\n  dependencies: ['bar-position', 'bar-monitor'],\r\n\r\n  init() {\r\n\r\n    this.reachedHooks = this.reachedHooks.bind(this)\r\n    this.leftHooks = this.leftHooks.bind(this)\r\n    this.shoulderedBar = this.shoulderedBar.bind(this)\r\n    this.returnedBar = this.returnedBar.bind(this)\r\n    this.hitTop = this.hitTop.bind(this)\r\n    this.loweredFromTop = this.loweredFromTop.bind(this)\r\n    this.hitTargetDepth = this.hitTargetDepth.bind(this)\r\n    this.upwardsFromTargetDepth = this.upwardsFromTargetDepth.bind(this)\r\n    this.belowSafetyPins = this.belowSafetyPins.bind(this)\r\n    this.bailedOut = this.bailedOut.bind(this)\r\n\r\n    this.el.addEventListener('reached-hooks', this.reachedHooks);\r\n    this.el.addEventListener('left-hooks', this.leftHooks);\r\n    this.el.addEventListener('shouldered-bar', this.shoulderedBar);\r\n    this.el.addEventListener('returned-bar', this.returnedBar);\r\n    this.el.addEventListener('hit-top', this.hitTop);\r\n    this.el.addEventListener('lowered-from-top', this.loweredFromTop);\r\n    this.el.addEventListener('hit-target-depth', this.hitTargetDepth);\r\n    this.el.addEventListener('upwards-from-target-depth', this.upwardsFromTargetDepth);\r\n    this.el.addEventListener('below-safety-pins', this.belowSafetyPins);\r\n    this.el.addEventListener('bailed-out', this.bailedOut);\r\n\r\n    this.state = {\r\n      repPhase: 'none',  // one of: none, ready, down, up, rest\r\n      repNumber: 0,\r\n      repsToGo: 5,\r\n      shutUp: false, // set to stop coaching on the set.\r\n      minHeightThisRep: 1000\r\n    }\r\n\r\n    this.timestamps = {\r\n      finishedLast: undefined,\r\n      beganRep: undefined,\r\n      hitDepth: undefined,\r\n      hitBottom: undefined,\r\n      finishedRep: undefined\r\n    }\r\n\r\n    this.insideRackUI = document.querySelector('#inside-rack-ui')\r\n    this.outsideRackUI = document.querySelector('#outside-rack-ui')\r\n\r\n    this.repData = {\r\n      repNumber: 0,\r\n      completed: false,\r\n      failed: false,\r\n      restPrior: undefined,\r\n      timeDown: undefined,\r\n      depth: undefined,\r\n      timeUp: undefined,\r\n      turnSpeed: undefined, // TO DO\r\n      deviationLR: undefined, // TO DO\r\n      deviationFB: undefined  // TO DO\r\n    }\r\n  },\r\n\r\n  remove() {\r\n    this.el.removeEventListener('reached-hooks', this.reachedHooks);\r\n    this.el.removeEventListener('left-hooks', this.leftHooks);\r\n    this.el.removeEventListener('shouldered-bar', this.shoulderedBar);\r\n    this.el.removeEventListener('returned-bar', this.returnedBar);\r\n    this.el.removeEventListener('hit-top', this.hitTop);\r\n    this.el.removeEventListener('lowered-from-top', this.loweredFromTop);\r\n    this.el.removeEventListener('hit-target-depth', this.hitTargetDepth);\r\n    this.el.removeEventListener('upwards-from-target-depth', this.upwardsFromTargetDepth);\r\n    this.el.removeEventListener('below-safety-pins', this.belowSafetyPins);\r\n    this.el.removeEventListener('bailed-out', this.bailedOut);\r\n  },\r\n\r\n  setTargetReps(repCount) {\r\n\r\n    this.state.repsToGo = repCount\r\n    this.insideRackUI.setAttribute('inside-rack-ui', {repsToGo: this.state.repsToGo})\r\n  },\r\n\r\n  repCompleted(success) {\r\n\r\n    // don't count any reps prior to calibration\r\n    const state = this.el.sceneEl.components['ui-manager'].state\r\n    if (!state.calibrated) return\r\n\r\n    this.timestamps.finishedRep = Date.now()\r\n\r\n    this.repData.completed = true\r\n    this.repData.failed = !success\r\n    this.repData.repNumber = this.state.repNumber\r\n    this.repData.timeUp = this.timestamps.finishedRep - this.timestamps.hitBottom\r\n    this.el.emit('rep-report', this.repData)\r\n    this.state.repsToGo--\r\n    this.state.repNumber++\r\n    this.insideRackUI.setAttribute('inside-rack-ui', {repsToGo: this.state.repsToGo})\r\n\r\n    // set up state for tracking next rep\r\n    this.state.minHeightThisRep = 1000\r\n    this.timestamps.finishedLast = Date.now()\r\n  },\r\n\r\n  reachedHooks() {\r\n\r\n    this.setMessage('Take weight of bar')\r\n  },\r\n\r\n  leftHooks() {\r\n    // no update needed\r\n  },\r\n\r\n  shoulderedBar() {\r\n    this.setMessage('Step Back')\r\n  },\r\n\r\n  returnedBar() {\r\n    this.setMessage('Finished!')\r\n  },\r\n\r\n  setMessage(message) {\r\n    this.insideRackUI.setAttribute('inside-rack-ui', {message: message})\r\n  },\r\n\r\n  hitTop() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.state.repPhase = 'ready'\r\n        this.setMessage('Ready!')\r\n        this.playPrompt('#sound-here-we-go')\r\n        // track time, count this as \"rest\" start for rep 1\r\n        this.timestamps.finishedLast = Date.now()\r\n        break\r\n\r\n      case 'down':\r\n        this.state.repPhase = 'rest'\r\n        this.setMessage('Incomplete Rep')\r\n        this.playPrompt('#sound-not-quite')\r\n\r\n        this.repData.repNumber = this.state.repNumber\r\n        const targetDepth = this.el.sceneEl.components['bar-monitor'].data.targetDepth\r\n        this.repData.depth = this.state.minHeightThisRep - targetDepth\r\n        this.el.emit('rep-report', this.repData)\r\n\r\n        // wipe data about previous effort at depth.\r\n        this.state.minHeightThisRep = 1000\r\n        break\r\n\r\n      case 'up':\r\n        this.state.repPhase = 'rest'\r\n        this.setMessage('Rep Complete')\r\n        this.repCompleted(true)\r\n        if (this.state.repsToGo === 0) {\r\n          this.playPrompt('#sound-good-job')\r\n          this.state.shutUp = true\r\n        }\r\n        else if (this.state.repsToGo === 1) {\r\n          this.playPrompt('#sound-last-one') \r\n        }\r\n        else {\r\n          this.playPrompt('#sound-nice')\r\n        }\r\n        break\r\n\r\n      default: \r\n        console.error(\"Hit Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  loweredFromTop() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.setMessage('Stand Taller before beginning reps')\r\n        break\r\n\r\n      case 'ready':\r\n      case 'rest':\r\n        this.state.repPhase = 'down'\r\n        this.setMessage('Going down...')\r\n        this.timestamps.beganRep = Date.now()\r\n\r\n        // 1st set of data for new rep.\r\n        this.repData.repNumber = this.state.repNumber\r\n        this.repData.completed = false\r\n        this.repData.failed = false\r\n        this.repData.restPrior = this.timestamps.beganRep - this.timestamps.finishedLast\r\n        this.repData.timeDown = undefined\r\n        this.repData.depth = undefined\r\n        this.repData.timeUp = undefined\r\n        this.repData.turnSpeed = undefined\r\n        this.repData.deviationLR = undefined\r\n        this.repData.deviationFB = undefined\r\n        this.el.emit('rep-report', this.repData)\r\n        break\r\n\r\n      case 'up':\r\n        this.setMessage('Stand at full height to complete last Rep!')\r\n        break\r\n\r\n      default: \r\n        console.error(\"Lowered From Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n\r\n  },\r\n\r\n  hitTargetDepth() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.setMessage('Stand at full height before beginning reps')\r\n        break\r\n\r\n      case 'down':\r\n        this.setMessage('Hit Depth!')\r\n        this.playSFX('#sfx-hit-depth')\r\n        this.state.repPhase = 'up'\r\n        this.timestamps.hitDepth = Date.now()\r\n\r\n        this.repData.timeDown = this.timestamps.hitDepth - this.timestamps.beganRep\r\n        this.el.emit('rep-report', this.repData)\r\n        break\r\n  \r\n      case 'up':\r\n        this.setMessage('Push up to complete this rep!')\r\n        break\r\n\r\n      default: \r\n        console.error(\"Lowered From Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  upwardsFromTargetDepth() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'up':\r\n        // assume we now hit our lowest point.\r\n        const targetDepth = this.el.sceneEl.components['bar-monitor'].data.targetDepth\r\n        this.repData.depth = this.state.minHeightThisRep - targetDepth\r\n        this.el.emit('rep-report', this.repData)\r\n\r\n        break\r\n\r\n      default: \r\n        console.error(\"Upwards from Target Depth in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  belowSafetyPins() {\r\n\r\n    this.setMessage('Failed set.  Step out of rack and remove weight plates from bar.')\r\n\r\n  },\r\n\r\n  bailedOut() {\r\n    this.repCompleted(false)\r\n    this.setMessage('Failed set.  Step out of rack and remove weight plates from bar.')\r\n  },\r\n\r\n  playPrompt(src) {\r\n\r\n    // don't play these clips until calibration is done.\r\n    const state = this.el.sceneEl.components['ui-manager'].state\r\n    if (!state.calibrated) return\r\n\r\n    // don't play clips when no reps remaining\r\n    if (this.state.shutUp) return\r\n\r\n    const origin = document.getElementById('sound-origin')\r\n\r\n    origin.removeAttribute('sound')\r\n    origin.setAttribute('sound', {src: src, autoplay: true})\r\n  },\r\n\r\n  playSFX(src) {\r\n\r\n    // don't play these clips until calibration is done.\r\n    const state = this.el.sceneEl.components['ui-manager'].state\r\n    if (!state.calibrated) return\r\n    \r\n    const origin = document.getElementById('sfx-origin')\r\n\r\n    origin.setAttribute('sound', {src: '', autoplay: false})\r\n    origin.setAttribute('sound', {src: src, autoplay: true})\r\n  },\r\n\r\n  tick() {\r\n    barPosition = this.el.sceneEl.components['bar-position'].barPosition\r\n\r\n    if (barPosition.y < this.state.minHeightThisRep) {\r\n      this.state.minHeightThisRep = barPosition.y\r\n      this.timestamps.hitBottom = Date.now() // should be accurate by end of rep!\r\n    }\r\n  }\r\n\r\n})\r\n","AFRAME.registerComponent('vertical-controls', {\r\n\r\n  init() {\r\n\r\n    this.verticalVelocity = 0\r\n    this.verticalAcceleration = 0\r\n\r\n    this.keyDown = this.keyDown.bind(this)\r\n    this.keyUp = this.keyUp.bind(this)\r\n\r\n    window.addEventListener('keydown', this.keyDown)\r\n    window.addEventListener('keyup', this.keyUp)\r\n  },\r\n\r\n  keyDown(e) {\r\n\r\n    if (e.key === \"o\") {\r\n      this.verticalAcceleration += 2\r\n    }\r\n\r\n    if (e.key === \"k\") {\r\n      this.verticalAcceleration = -2\r\n    }\r\n  },\r\n\r\n  keyUp(e) {\r\n    \r\n    if (e.key === \"o\" || e.key === \"k\") {\r\n      this.verticalVelocity = 0\r\n      this.verticalAcceleration = 0\r\n    }\r\n  },\r\n\r\n  tick(t, dt) {\r\n\r\n    velDelta = dt * this.verticalAcceleration / 1000\r\n    this.verticalVelocity += velDelta\r\n    if (this.verticalVelocity > 1) this.verticalVelocity = 1\r\n    if (this.verticalVelocity < -1) this.verticalVelocity = -1\r\n\r\n    yDelta = dt * this.verticalVelocity / 1000\r\n    this.el.object3D.position.y += yDelta\r\n  }\r\n})","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/* global AFRAME, THREE */\r\n\r\nrequire('./src/bar-position.js')\r\nrequire('./src/bar-monitor.js')\r\nrequire('./src/in-rack-ui.js')\r\nrequire('./src/ui-updater.js')\r\nrequire('./src/squat-rack.js')\r\nrequire('./src/vertical-controls.js')\r\n//require('./src/nod-shake.js')\r\nrequire('./src/calibration-flow')\r\nrequire('./src/ui-manager')\r\nrequire('aframe-polygon-wireframe')"],"names":["root","factory","exports","module","define","amd","a","i","self","AFRAME","registerComponent","schema","color","type","default","opacity","hiddenOpacity","dashed","dashSize","gapSize","dashScale","init","this","updateGeometry","bind","el","addEventListener","getObject3D","baseGeometry","geometry","edges","dispose","THREE","EdgesGeometry","update","oldMaterial","material","oldLine","line","oldHiddenMaterial","hiddenMaterial","oldHiddenLine","hiddenLine","data","createLineMaterial","console","warn","depthWrite","depthTest","toneMapped","LineSegments","computeLineDistances","object3D","add","visible","removeLineAndMaterial","removeFromParent","LineDashedMaterial","scale","LineBasicMaterial","transparent","remove","removeEventListener","dependencies","hookPosition","x","y","z","topHeight","targetDepth","safetyPinHeight","rackWidth","rackDepth","showPlanes","state","insideRack","lifterAtHooks","barOnShoulders","atTop","belowDepth","belowSafetyPins","deletePlanes","createPlanes","topPlaneUpwards","createPlane","depthPlaneUpwards","safetyPlaneTop","safetyPlaneBottom","deletePlane","plane","parentNode","removeChild","aboveTopPlane","height","document","createElement","setAttribute","querySelector","appendChild","isInsideRack","barPosition","insideLR","insideFB","Math","abs","zOffset","checkIfInsideRack","emit","isAtHooks","atHooksLR","atHooksFB","checkIfAtHooks","isAtTop","checkIfAtTop","isBelowDepth","checkIfBelowDepth","isBelowSafetyPins","checkIfBelowSafetyPins","tick","sceneEl","components","createRing","radius","ring","rotation","PI","position","cameraPosition","Vector3","cameraQuaternion","Quaternion","tempQuaternion","rackEl","rack","rackInverseTransform","Matrix4","updateWorldMatrix","copy","matrixWorld","invert","barOffset","getCameraAndBarPosition","quaternion","camera","getWorldPosition","getWorldQuaternion","applyMatrix4","setFromRotationMatrix","multiply","addVectors","calibrationUIImages","start","bar","hooks","top","depth","safety","review","done","calibrationUISounds","calibrationUIFollowOnSounds","calibrationUIFollowOnSounds2","skip","reachedHooks","forwardEvent","backEvent","stage","calibrationUI","getElementById","cameraWorldPosition","cameraWorldQuaternion","forwardVector","directionVector","playSFX","setTimeout","playPrompt","video","play","endCalibrationProcess","updateUI","beginCalibrationProcess","getBarPosition","moveToStage","moveBackToStage","origin","src","autoplay","sound","playSound","forward","direction","applyQuaternion","normalize","setFromUnitVectors","pos","ypos","error","back","saving","deleting","forwardButton","backButton","imageSelector","fowardButton","circle","deleteImage","createImage","deleteButtons","createButtons","createButton","imageSrc","eventName","button","deleteButton","parent","dimension","image","classList","animatedRing","property","from","to","dur","easing","removeAttribute","totalReps","repsToGo","width","message","reps","ii","rep","repNumber","push","repReport","e","detail","completed","failed","log","status","restPrior","timeDown","timeUp","turnSpeed","daviationLR","deviationLR","deviationFB","reportStats","key","label","units","number","wrapCount","value","align","childStats","imgSrc","deleteReportStats","forEach","stat","index","child","numberText","toFixed","registerGeometry","frontHeight","rearHeight","frameWidth","hookRadiusSmall","hookRadiusLarge","hookDepth","hookHeight","safetyHeight","safetyRadius","geometries","BoxGeometry","translate","CylinderGeometry","rotateX","BufferGeometryUtils","mergeBufferGeometries","primitive","calibrated","inRack","calibrationComplete","enteredRack","exitedRack","insideRackUI","outsideRackUI","cursor","videoFrame","updateUIs","updateVisibility","leftHooks","shoulderedBar","returnedBar","hitTop","loweredFromTop","hitTargetDepth","upwardsFromTargetDepth","bailedOut","repPhase","shutUp","minHeightThisRep","timestamps","finishedLast","undefined","beganRep","hitDepth","hitBottom","finishedRep","repData","setTargetReps","repCount","repCompleted","success","Date","now","setMessage","verticalVelocity","verticalAcceleration","keyDown","keyUp","window","t","dt","velDelta","yDelta","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"sourceRoot":""}