{"version":3,"file":"squatmaster.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;;;;;;;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,wBAAwB,uBAAuB;AACnE;AACA;AACA,iBAAiB,aAAa;AAC9B;AACA;AACA,kBAAkB,aAAa;AAC/B;AACA;AACA,sBAAsB,aAAa;AACnC;AACA;AACA,gBAAgB,WAAW;AAC3B;AACA;AACA,gBAAgB;AAChB,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;AC1QD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;AC1ED;AACA;AACA;AACA,eAAe,WAAW;AAC1B,cAAc;AACd,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC;AACA,oDAAoD;AACpD;AACA,GAAG;AACH;AACA;AACA;AACA,6CAA6C,kBAAkB,IAAI,oBAAoB;AACvF;AACA;AACA,CAAC;;;;;;;;;;;ACxBD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,aAAa;AAClC,uBAAuB,aAAa;AACpC,YAAY;AACZ,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;ACtJD;AACA;AACA;AACA;AACA,cAAc,WAAW;AACzB,cAAc,WAAW;AACzB,oBAAoB,aAAa;AACjC,mBAAmB,aAAa;AAChC,mBAAmB,cAAc;AACjC,wBAAwB,cAAc;AACtC,wBAAwB,cAAc;AACtC,kBAAkB,cAAc;AAChC,mBAAmB,aAAa;AAChC,qBAAqB,aAAa;AAClC,qBAAqB,cAAc;AACnC,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,WAAW;AACvB,kBAAkB,aAAa;AAC/B,iBAAiB,aAAa;AAC9B,iBAAiB,cAAc;AAC/B,sBAAsB,cAAc;AACpC,sBAAsB,cAAc;AACpC,gBAAgB,cAAc;AAC9B,iBAAiB,aAAa;AAC9B,mBAAmB,aAAa;AAChC,mBAAmB,cAAc;AACjC,GAAG;AACH;AACA;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2EAA2E;AAC3E;AACA,sCAAsC,cAAc;AACpD;AACA,CAAC;;;;;;;;;;ACjID;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,kDAAkD,8BAA8B;AAChF,GAAG;AACH;AACA;AACA;AACA;AACA,kDAAkD,8BAA8B;AAChF,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,kDAAkD,iBAAiB;AACnE,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;ACtND;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;UC3CD;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;;ACtBA;AACA;AACA,mBAAO,CAAC,oDAAuB;AAC/B,mBAAO,CAAC,kDAAsB;AAC9B,mBAAO,CAAC,gDAAqB;AAC7B,mBAAO,CAAC,gDAAqB;AAC7B,mBAAO,CAAC,gDAAqB;AAC7B,mBAAO,CAAC,8DAA4B;AACpC,mBAAO,CAAC,8CAAoB,C","sources":["webpack://squatmaster/webpack/universalModuleDefinition","webpack://squatmaster/./src/bar-monitor.js","webpack://squatmaster/./src/bar-position.js","webpack://squatmaster/./src/in-rack-ui.js","webpack://squatmaster/./src/nod-shake.js","webpack://squatmaster/./src/squat-rack.js","webpack://squatmaster/./src/ui-updater.js","webpack://squatmaster/./src/vertical-controls.js","webpack://squatmaster/webpack/bootstrap","webpack://squatmaster/./index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, () => {\nreturn ","// component set on scene.\r\n// Contains configuration of key bar thresholds.\r\n// Monitors bar position and generates events when thresholds are hit.\r\nAFRAME.registerComponent('bar-monitor', {\r\n\r\n  dependencies: ['bar-position'],\r\n\r\n  schema: {\r\n    // Position of bar when on hooks (before the lift begins)\r\n    // Co-ordinates in rack space.\r\n    hookPosition : {type: 'vec3', default: {x: 0, y: 1.5, z: -0.5}},\r\n\r\n    // height of bar when lifter is standing up straight.\r\n    topHeight : {default: 1.7},\r\n\r\n    // target depth for bar, to achieve parallel thighs.\r\n    targetDepth: {default: 0.6},\r\n\r\n    // height of the bar when it hits the safety pins.\r\n    safetyPinHeight: {default: 0.5},\r\n\r\n    // width of rack in meters\r\n    rackWidth: {default: 1},\r\n\r\n    // depth (z-direction) of rack in meters\r\n    rackDepth: {default: 1}\r\n  },\r\n\r\n  init() {\r\n\r\n    this.state = {\r\n      insideRack : false,\r\n      lifterAtHooks : false,\r\n      barOnShoulders : false,\r\n      atTop : false,\r\n      belowDepth : false,\r\n      belowSafetyPins : false,\r\n    }\r\n  },\r\n\r\n  isInsideRack(barPosition) {\r\n\r\n    let insideLR, insideFB\r\n\r\n    if (Math.abs(barPosition.x - this.data.hookPosition.x) < this.data.rackWidth / 2) {\r\n      insideLR = true\r\n    }\r\n\r\n    // zOffset relative to hook Position will be positive (up to rack depth)\r\n    // or very small negative (to 10cm tolerance) when inside the rack.\r\n    const zOffset = barPosition.z - this.data.hookPosition.z\r\n    if ((zOffset) < this.data.rackDepth && \r\n        (zOffset) > -0.1) {\r\n      insideFB = true\r\n    }\r\n\r\n    return (insideLR && insideFB)\r\n\r\n  },\r\n\r\n  checkIfInsideRack(barPosition) {\r\n    if (this.isInsideRack(barPosition)) {\r\n\r\n      if (!this.state.insideRack) {\r\n        this.el.emit('entered-rack')\r\n      }\r\n\r\n      this.state.insideRack = true\r\n    }\r\n    else {\r\n      if (this.state.insideRack) {\r\n        this.el.emit('exited-rack')\r\n      }\r\n\r\n      this.state.insideRack = false\r\n    }\r\n\r\n    return this.state.insideRack\r\n  },\r\n\r\n  isAtHooks(barPosition) {\r\n\r\n    let atHooksLR, atHooksFB\r\n\r\n    // for L-R, anywhere in rack will do.\r\n    if (Math.abs(barPosition.x - this.data.hookPosition.x) < this.data.rackWidth / 2) {\r\n      atHooksLR = true\r\n    }\r\n\r\n    // 10cm tolerance for Front-Back.\r\n\r\n    // Note: user can subvert logic by bringing in bar very close to pins, then lowering directly in front of pins.\r\n    // App will assume bar has been returned to rack, when in fact it's still on users' shoulders.\r\n    // This behaviour seems really unlikely to happen, unless user is deliberatly trying to subvert the app...\r\n\r\n    // Not sure we can do any better without introducing risk of false negatives when bar\r\n    // is legitimately returned to the hooks.\r\n    if (Math.abs(this.data.hookPosition.z - barPosition.z) < 0.05) {\r\n      atHooksFB = true\r\n    }\r\n\r\n    return atHooksLR && atHooksFB\r\n  },\r\n\r\n  checkIfAtHooks(barPosition) {\r\n\r\n    if (this.isAtHooks(barPosition)) {\r\n      if (!this.state.lifterAtHooks) {\r\n        this.el.emit('reached-hooks')\r\n      }\r\n      this.state.lifterAtHooks = true\r\n    }\r\n    else {\r\n      if (this.state.lifterAtHooks) {\r\n        // lifter leaving hooks.\r\n        // may or may not have bar on shoulders.  Determine based on y position.\r\n\r\n        if (barPosition.y > this.data.hookPosition.y) {\r\n          // bar above hooks - must be on shoulders.\r\n\r\n          if (!this.state.barOnShoulders) {\r\n\r\n            this.el.emit('shouldered-bar')\r\n          }\r\n          \r\n          this.state.barOnShoulders = true\r\n        }\r\n        else {\r\n          // bar below hooks - must have deposited it back on the hooks.\r\n\r\n          if (this.state.barOnShoulders) {\r\n\r\n            this.el.emit('returned-bar')\r\n          }\r\n          \r\n          this.state.barOnShoulders = false\r\n        }\r\n\r\n        this.el.emit('left-hooks')\r\n      }\r\n      this.state.lifterAtHooks = false\r\n    }\r\n\r\n    return this.state.lifterAtHooks\r\n  },\r\n\r\n  isAtTop(barPosition) {\r\n\r\n    // 5cm tolerance.  Anything over top is considered at top.\r\n    if (this.data.topHeight - barPosition.y < 0.05) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfAtTop(barPosition) {\r\n    if (this.isAtTop(barPosition)) {\r\n\r\n      if (!this.state.atTop) {\r\n        this.el.emit('hit-top')\r\n      }\r\n\r\n      this.state.atTop = true\r\n    }\r\n    else {\r\n      if (this.state.atTop) {\r\n        this.el.emit('lowered-from-top')\r\n      }\r\n\r\n      this.state.atTop = false\r\n    }\r\n\r\n    return this.state.atTop\r\n  },\r\n\r\n  isBelowDepth(barPosition) {\r\n\r\n    // Below target depth.  No tolerance - must pass target depth.\r\n    if (barPosition.y < this.data.targetDepth) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfBelowDepth(barPosition) {\r\n    if (this.isBelowDepth(barPosition)) {\r\n\r\n      if (!this.state.belowDepth) {\r\n        this.el.emit('hit-target-depth')\r\n      }\r\n\r\n      this.state.belowDepth = true\r\n    }\r\n    else {\r\n      if (this.state.belowDepth) {\r\n        this.el.emit('upwards-from-target-depth')\r\n      }\r\n\r\n      this.state.belowDepth = false\r\n    }\r\n\r\n    return this.state.belowDepth\r\n  },\r\n\r\n  isBelowSafetyPins(barPosition) {\r\n\r\n    // Below safety pins\r\n    // wait until fully 5cm below, to be sure lifter is bailing out, not just performing a deep rep.\r\n    if (barPosition.y < (this.data.safetyPinHeight - 0.05)) {\r\n      return true\r\n    }\r\n    else {\r\n      return false\r\n    }\r\n  },\r\n\r\n  checkIfBelowSafetyPins(barPosition) {\r\n    if (this.isBelowSafetyPins(barPosition)) {\r\n\r\n      if (!this.state.belowSafetyPins) {\r\n        this.el.emit('below-safety-pins')\r\n      }\r\n\r\n      this.state.belowSafetyPins = true\r\n    }\r\n    else {\r\n      if (this.state.belowSafetyPins) {\r\n        this.el.emit('bailed-out')\r\n\r\n        // following bail-out, bar is no longer on the shoulders.\r\n        this.state.barOnShoulders = false\r\n      }\r\n\r\n      this.state.belowSafetyPins = false\r\n    }\r\n\r\n    return this.state.belowSafetyPins\r\n  },\r\n\r\n  tick() {\r\n    barPosition = this.el.sceneEl.components['bar-position'].barPosition\r\n\r\n    // is the lifter inside the rack?\r\n    const insideRack = this.checkIfInsideRack(barPosition)\r\n\r\n    // if not inside rack, nothing else can happen.\r\n    if (!insideRack) return\r\n\r\n    // is the lifter at the pins (likely either taking on, or dropping off the bar?)\r\n    // This also updates state about whether or not the lifter has the bar on their shoulders.\r\n    this.checkIfAtHooks(barPosition)\r\n\r\n    // is the lifter at the top of a rep?\r\n    this.checkIfAtTop(barPosition)\r\n\r\n    // has the lifter gone below target depth?\r\n    this.checkIfBelowDepth(barPosition)\r\n\r\n    // has the lifter bailed out on the safety pins?\r\n    this.checkIfBelowSafetyPins(barPosition)\r\n\r\n  }\r\n})","\r\n// Component set on scene.\r\n// Tracks camera and maintains public data for\r\n// - cameraPostion\r\n// - cameraQuaternion\r\n// - barPosition\r\n// All as measured in rack space.\r\n\r\n// No implemented support for switching camera / multi-camera\r\n\r\n// as far as possible, we try to work in rack space.\r\n// In rack space, x is left-right and z is forward (+ve) and backward (-ve)\r\n// Typically this will not align with world space.\r\n\r\nAFRAME.registerComponent('bar-position', {\r\n  \r\n  init() {\r\n    // called once when component is added to an entity\r\n\r\n    // camera position & quaternion in Rack Space.  Updated every tick.\r\n    this.cameraPosition = new THREE.Vector3()\r\n    this.cameraQuaternion = new THREE.Quaternion()\r\n\r\n    // for working\r\n    this.tempQuaternion = new THREE.Quaternion()\r\n\r\n    // world position of rack.\r\n    this.rackEl = document.querySelector('#rack')\r\n    rack = this.rackEl.object3D\r\n    this.rackInverseTransform = new THREE.Matrix4()\r\n    rack.updateWorldMatrix()\r\n    this.rackInverseTransform.copy(rack.matrixWorld)\r\n    this.rackInverseTransform.invert()\r\n\r\n    // now if I apply rackInverseTransform to an object in worldSpace, I get it's transform in rack space.\r\n    // vector to track bar position, in rack-space.\r\n    // Public.\r\n    this.barPosition = new THREE.Vector3()\r\n    \r\n    this.barOffset = new THREE.Vector3()\r\n    // for now, hard code bar 20 cm behind camera, 10cm below\r\n    this.barOffset.set(0, -0.1, -0.2)\r\n    this.getCameraAndBarPosition()\r\n    \r\n  },\r\n\r\n  getCameraAndBarPosition() {\r\n\r\n    const position = this.cameraPosition\r\n    const quaternion = this.cameraQuaternion\r\n\r\n    this.el.sceneEl.camera.getWorldPosition(position);\r\n    this.el.sceneEl.camera.getWorldQuaternion(quaternion);\r\n\r\n    const rackInverseTransform = this.rackInverseTransform\r\n    position.applyMatrix4(rackInverseTransform)\r\n    this.tempQuaternion.setFromRotationMatrix(rackInverseTransform)\r\n    quaternion.multiply(this.tempQuaternion)\r\n\r\n    this.barPosition.addVectors(this.cameraPosition, this.barOffset)\r\n\r\n    // bar quaternion is assumed to always be the identity\r\n    // bar in standard orientation across the rack.\r\n  },\r\n\r\n  update() {\r\n    // called whenever component properties are updated\r\n\r\n  },\r\n\r\n  tick() {\r\n\r\n    this.getCameraAndBarPosition()\r\n  }\r\n})","AFRAME.registerComponent('in-rack-ui', {\r\n\r\n  schema: {\r\n    repsToGo: {default: 5},\r\n    message: {default: ''}\r\n  },\r\n\r\n  init() {\r\n    this.circle = document.createElement('a-circle')\r\n    this.circle.setAttribute('radius', 0.5)\r\n    this.el.appendChild(this.circle)\r\n\r\n    this.text = document.createElement('a-entity')\r\n    this.text.setAttribute('text', {color:  'black',\r\n                                    wrapCount: 15,\r\n                                    align: 'center'})\r\n    this.circle.appendChild(this.text)\r\n  },\r\n\r\n  update() {\r\n\r\n    this.text.setAttribute('text', `value: ${this.data.message}\\n${this.data.repsToGo} reps to go`)\r\n\r\n  }\r\n});\r\n","// Add to scene (it finds camera itself)\r\n// Generates 'nod' and 'shake' events\r\n\r\nAFRAME.registerComponent('nod-shake', {\r\n\r\n  schema: {\r\n    // sensitivity is measured in required cmulative radians of rotation (in either direction)\r\n    // without any significant movement that is dominated by another axis.\r\n    // 1 radian = approx 57 degrees\r\n    // For simplicity, we allow nods in both X & Z axis.  Unlikely to trigger false positives as\r\n    // head tilt is an unusual movement.  And means we don't need to worry about the camera's Y rotation.\r\n    // in determining which direction is \"nodding\"\r\n    nodSensitivity: {default: 0.5},\r\n    shakeSensitivity: {default: 0.5},\r\n    debug: {default: false}\r\n  },\r\n\r\n  init() {\r\n\r\n    this.cameraQuaternion = new THREE.Quaternion\r\n    this.lastQuaternion = new THREE.Quaternion\r\n    this.deltaQuaternion = new THREE.Quaternion\r\n    this.camera = this.el.sceneEl.camera\r\n\r\n    this.firstFrame = true\r\n\r\n    this.cumRotNod = 0\r\n    this.cumRotShake = 0\r\n\r\n    this.debugDisplayCounter = 0\r\n  },\r\n\r\n  update() {\r\n    if (this.data.debug) {\r\n      this.display = document.createElement('a-text')\r\n      this.display.object3D.position.set(0, 0, -3)\r\n      this.display.setAttribute('align', 'center')\r\n      this.display.setAttribute('value', 'Nod/shake debug')\r\n      this.camera.el.appendChild(this.display)\r\n    }\r\n    else {\r\n      if (this.display) {\r\n        this.display.parentNode.removeChild(this.display)\r\n        this.display = null\r\n      }\r\n    }\r\n  },\r\n\r\n  // primes debug display to reset 1 second after changes stop.\r\n  primeDebugReset() {\r\n    this.debugDisplayCounter++\r\n\r\n    setTimeout(() => {\r\n      this.debugDisplayCounter--\r\n      if (this.debugDisplayCounter <= 0) {\r\n        this.display.setAttribute('text', 'value: Nod/shake debug')\r\n      }\r\n    }, 1000)\r\n  },\r\n\r\n  tick() {\r\n\r\n    // avoid false positives at start of day\r\n    if (this.firstFrame) {\r\n      this.firstFrame = false\r\n      return\r\n    }\r\n\r\n    const quaternion = this.cameraQuaternion\r\n    const delta = this.deltaQuaternion\r\n\r\n    this.el.sceneEl.camera.getWorldQuaternion(quaternion);\r\n\r\n    // compute delta quaternion from last frame to this frame\r\n    delta.copy(this.lastQuaternion)\r\n    delta.invert()\r\n    delta.premultiply(quaternion)\r\n\r\n    // Convert to axis and angle as described here.\r\n    // https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm   \r\n    delta.normalize()\r\n    const s = Math.sqrt(1-delta.w*delta.w)\r\n    if (s < 0.0001) {\r\n      // no significant movement\r\n    }\r\n    else {\r\n\r\n      const angle = 2 * Math.acos(delta.w)\r\n      const absAngle = Math.abs(angle)\r\n      console.log(\"Absolute angle of rotation: \", absAngle)\r\n\r\n      let x = delta.x\r\n      let y = delta.y\r\n      let z = delta.z\r\n\r\n      if (Math.abs(x) >= Math.abs(y) && Math.abs(x) >= Math.abs(z)) {\r\n        // x axis dominant\r\n        this.cumRotNod += absAngle\r\n        this.cumRotShake = 0\r\n        \r\n        if (this.data.debug) {\r\n          console.log(\"X-axis dominant.  Accumulated nod rotation:\", this.cumRotNod)\r\n        }\r\n      }\r\n      else if (Math.abs(y) >= Math.abs(x) && Math.abs(y) >= Math.abs(z)) {\r\n        // y axis dominant\r\n        this.cumRotNod = 0\r\n        this.cumRotShake += absAngle\r\n        \r\n        if (this.data.debug) {\r\n          console.log(\"Y-axis dominant.  Accumulated shake rotation:\", this.cumRotShake)\r\n        }\r\n      }\r\n      else {\r\n        // z-axis dominant\r\n        this.cumRotNod += absAngle\r\n        this.cumRotShake = 0\r\n\r\n        if (this.data.debug) {\r\n          console.log(\"Z-axis dominant.  Accumulated nod rotation:\", this.cumRotNod)\r\n        }\r\n      }\r\n    }\r\n\r\n    // has any cumulative rotation broken threshold?\r\n    if (this.cumRotNod > this.data.nodSensitivity) {\r\n      this.el.emit(\"nod\")\r\n      this.cumRotNod = 0\r\n\r\n      if (this.data.debug) {\r\n        console.log(\"Emitted nod event\")\r\n        this.display.setAttribute('text', 'value: Detected nod')\r\n        this.primeDebugReset()\r\n      }\r\n    }\r\n\r\n    if (this.cumRotShake > this.data.shakeSensitivity) {\r\n      this.el.emit(\"shake\")\r\n      this.cumRotShake = 0\r\n\r\n      if (this.data.debug) {\r\n        console.log(\"Emitted shake event\")\r\n        this.display.setAttribute('text', 'value: Detected shake')\r\n        this.primeDebugReset()\r\n      }\r\n    }\r\n\r\n    // save off this quaternion for analysis next frame\r\n    this.lastQuaternion.copy(quaternion)\r\n  }\r\n})","AFRAME.registerGeometry('squatRack', {\r\n\r\n  schema: {\r\n    schema: {\r\n      width: {default: 1},\r\n      depth: {default: 1},\r\n      frontHeight: {default: 2.2},\r\n      rearHeight: {default: 1.8},\r\n      frameWidth: {default: 0.08},\r\n      hookRadiusSmall: {default: 0.02},\r\n      hookRadiusLarge: {default: 0.04},\r\n      hookDepth: {default: 0.08},\r\n      hookHeight: {default: 1.5},\r\n      safetyHeight: {default: 0.5},\r\n      safetyRadius: {default: 0.02},\r\n    },\r\n  },\r\n\r\n  init(data) {\r\n    const geometries = []\r\n    let geometry\r\n\r\n    // Origin of rack is center of rack, at floor level.\r\n\r\n    // post, back left\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.rearHeight, data.frameWidth)\r\n    geometry.translate(-data.width / 2, data.rearHeight / 2, data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, back right\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.rearHeight, data.frameWidth)\r\n    geometry.translate(data.width / 2, data.rearHeight / 2, data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, front left\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.frontHeight, data.frameWidth)\r\n    geometry.translate(-data.width / 2, data.frontHeight / 2, -data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // post, back right\r\n    geometry = new THREE.BoxGeometry(data.frameWidth, data.frontHeight, data.frameWidth)\r\n    geometry.translate(data.width / 2, data.frontHeight / 2, -data.depth / 2)\r\n    geometries.push(geometry)\r\n\r\n    // hooks...\r\n    // left hook\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusSmall,\r\n                                          data.hookRadiusSmall,\r\n                                          data.hookDepth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth / 2)\r\n    geometries.push(geometry)\r\n\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusLarge,\r\n                                          data.hookRadiusLarge,\r\n                                          0.01)\r\n                                          geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth)\r\n    geometries.push(geometry)\r\n\r\n    // right hook\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusSmall,\r\n                                          data.hookRadiusSmall,\r\n                                          data.hookDepth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth / 2)\r\n    geometries.push(geometry)\r\n\r\n    geometry = new THREE.CylinderGeometry(data.hookRadiusLarge,\r\n                                          data.hookRadiusLarge,\r\n                                          0.01)\r\n                                          geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.hookHeight, -data.depth / 2 + data.hookDepth)\r\n    geometries.push(geometry)\r\n\r\n    // left safety pin\r\n    geometry = new THREE.CylinderGeometry(data.safetyRadius,\r\n                                          data.safetyRadius,\r\n                                          data.depth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(-data.width / 2, data.safetyHeight, 0)\r\n    geometries.push(geometry)\r\n\r\n    // right safety pin\r\n    geometry = new THREE.CylinderGeometry(data.safetyRadius,\r\n                                          data.safetyRadius,\r\n                                          data.depth)\r\n    geometry.rotateX(Math.PI/2)\r\n    geometry.translate(data.width / 2, data.safetyHeight, 0)\r\n    geometries.push(geometry)\r\n\r\n    this.geometry = THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);\r\n  }\r\n\r\n})\r\n\r\nAFRAME.registerComponent('squat-rack', {\r\n\r\n  schema: {\r\n    width: {default: 1},\r\n    depth: {default: 1},\r\n    frontHeight: {default: 2.2},\r\n    rearHeight: {default: 1.8},\r\n    frameWidth: {default: 0.08},\r\n    hookRadiusSmall: {default: 0.02},\r\n    hookRadiusLarge: {default: 0.04},\r\n    hookDepth: {default: 0.08},\r\n    hookHeight: {default: 1.5},\r\n    safetyHeight: {default: 0.5},\r\n    safetyRadius: {default: 0.02},\r\n  },\r\n\r\n  init() {\r\n\r\n    this.el.setAttribute('geometry', {primitive: 'squatRack', \r\n                                      width: this.data.width,\r\n                                      depth: this.data.depth,\r\n                                      frontHeight: this.data.frontHeight,\r\n                                      rearHeight: this.data.rearHeight,\r\n                                      frameWidth: this.data.frameWidth,\r\n                                      hookRadiusSmall: this.data.hookRadiusSmall,\r\n                                      hookRadiusLarge: this.data.hookRadiusLarge,\r\n                                      hookDepth: this.data.hookDepth,\r\n                                      hookHeight: this.data.hookHeight,\r\n                                      safetyHeight: this.data.safetyHeight,\r\n                                      safetyRadius: this.data.safetyRadius})\r\n\r\n    this.el.setAttribute('material', {color: '#333'})\r\n  }\r\n})","// Configure on scene.\r\n\r\n// Updates UI component(s) to display rep status\r\n\r\nAFRAME.registerComponent('ui-updater', {\r\n\r\n  init() {\r\n\r\n    this.enteredRack = this.enteredRack.bind(this)\r\n    this.exitedRack = this.exitedRack.bind(this)\r\n    this.reachedHooks = this.reachedHooks.bind(this)\r\n    this.leftHooks = this.leftHooks.bind(this)\r\n    this.shoulderedBar = this.shoulderedBar.bind(this)\r\n    this.returnedBar = this.returnedBar.bind(this)\r\n    this.hitTop = this.hitTop.bind(this)\r\n    this.loweredFromTop = this.loweredFromTop.bind(this)\r\n    this.hitTargetDepth = this.hitTargetDepth.bind(this)\r\n    this.upwardsFromTargetDepth = this.upwardsFromTargetDepth.bind(this)\r\n    this.belowSafetyPins = this.belowSafetyPins.bind(this)\r\n    this.bailedOut = this.bailedOut.bind(this)\r\n\r\n    this.el.addEventListener('entered-rack', this.enteredRack);\r\n    this.el.addEventListener('exited-rack', this.exitedRack);\r\n    this.el.addEventListener('reached-hooks', this.reachedHooks);\r\n    this.el.addEventListener('left-hooks', this.leftHooks);\r\n    this.el.addEventListener('shouldered-bar', this.shoulderedBar);\r\n    this.el.addEventListener('returned-bar', this.returnedBar);\r\n    this.el.addEventListener('hit-top', this.hitTop);\r\n    this.el.addEventListener('lowered-from-top', this.loweredFromTop);\r\n    this.el.addEventListener('hit-target-depth', this.hitTargetDepth);\r\n    this.el.addEventListener('upwards-from-target-depth', this.upwardsFromTargetDepth);\r\n    this.el.addEventListener('below-safety-pins', this.belowSafetyPins);\r\n    this.el.addEventListener('bailed-out', this.bailedOut);\r\n\r\n    this.state = {\r\n      repPhase: 'none',  // one of: none, ready, down, up, rest\r\n      repsToGo: 0\r\n    }\r\n\r\n    this.insideRackUI = document.querySelector('#inside-rack-ui')\r\n    this.outsideRackUI = document.querySelector('#outside-rack-ui')\r\n\r\n  },\r\n\r\n  remove() {\r\n    this.el.removeEventListener('entered-rack', this.enteredRack);\r\n    this.el.removeEventListener('exited-rack', this.exitedRack);\r\n    this.el.removeEventListener('reached-hooks', this.reachedHooks);\r\n    this.el.removeEventListener('left-hooks', this.leftHooks);\r\n    this.el.removeEventListener('shouldered-bar', this.shoulderedBar);\r\n    this.el.removeEventListener('returned-bar', this.returnedBar);\r\n    this.el.removeEventListener('hit-top', this.hitTop);\r\n    this.el.removeEventListener('lowered-from-top', this.loweredFromTop);\r\n    this.el.removeEventListener('hit-target-depth', this.hitTargetDepth);\r\n    this.el.removeEventListener('upwards-from-target-depth', this.upwardsFromTargetDepth);\r\n    this.el.removeEventListener('below-safety-pins', this.belowSafetyPins);\r\n    this.el.removeEventListener('bailed-out', this.bailedOut);\r\n  },\r\n\r\n  setTargetReps(repCount) {\r\n\r\n    this.state.repsToGo = repCount\r\n    this.insideRackUI.setAttribute('in-rack-ui', {repsToGo: this.state.repsToGo})\r\n  },\r\n\r\n  repCompleted() {\r\n\r\n    this.state.repsToGo--\r\n    this.insideRackUI.setAttribute('in-rack-ui', {repsToGo: this.state.repsToGo})\r\n  },\r\n\r\n  enteredRack() {\r\n\r\n    if (this.insideRackUI) {\r\n      this.insideRackUI.setAttribute('visible', true)\r\n    }\r\n    \r\n    if (this.outsideRackUI) {\r\n      this.outsideRackUI.setAttribute('visible', false)\r\n    }\r\n\r\n    this.setTargetReps(5)\r\n\r\n  },\r\n\r\n  exitedRack() {\r\n\r\n    if (this.insideRackUI) {\r\n      this.insideRackUI.setAttribute('visible', false)\r\n    }\r\n    \r\n    if (this.outsideRackUI) {\r\n      this.outsideRackUI.setAttribute('visible', true)\r\n    }\r\n  },\r\n\r\n  reachedHooks() {\r\n\r\n    this.setMessage('Take weight of bar')\r\n  },\r\n\r\n  leftHooks() {\r\n    // no update needed\r\n  },\r\n\r\n  shoulderedBar() {\r\n    this.setMessage('Step Back')\r\n  },\r\n\r\n  returnedBar() {\r\n    this.setMessage('Finished!')\r\n  },\r\n\r\n  setMessage(message) {\r\n    this.insideRackUI.setAttribute('in-rack-ui', {message: message})\r\n  },\r\n\r\n  hitTop() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.state.repPhase = 'ready'\r\n        this.setMessage('Ready!')\r\n        break\r\n\r\n      case 'down':\r\n        this.state.repPhase = 'rest'\r\n        this.setMessage('Incomplete Rep')\r\n        break\r\n\r\n      case 'up':\r\n        this.state.repPhase = 'rest'\r\n        this.setMessage('Rep Complete')\r\n        this.repCompleted()\r\n        break\r\n\r\n      default: \r\n        console.error(\"Hit Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  loweredFromTop() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.setMessage('Stand Taller before beginning reps')\r\n        break\r\n\r\n      case 'ready':\r\n      case 'rest':\r\n        this.state.repPhase = 'down'\r\n        this.setMessage('Going down...')\r\n        break\r\n\r\n      case 'up':\r\n        this.setMessage('Stand at full height to complete last Rep!')\r\n        break\r\n\r\n      default: \r\n        console.error(\"Lowered From Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n\r\n  },\r\n\r\n  hitTargetDepth() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'none':\r\n        this.setMessage('Stand at full height before beginning reps')\r\n        break\r\n\r\n      case 'down':\r\n        this.setMessage('Hit Depth!')\r\n        this.state.repPhase = 'up'\r\n        break\r\n  \r\n      case 'up':\r\n        this.setMessage('Push up to complete this rep!')\r\n        break\r\n\r\n      default: \r\n        console.error(\"Lowered From Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  upwardsFromTargetDepth() {\r\n\r\n    // one of: none, ready, down, up, rest\r\n    switch (this.state.repPhase) {\r\n\r\n      case 'up':\r\n        // expected.  No action / state change needed\r\n        break\r\n\r\n      default: \r\n        console.error(\"Lowered From Top in unexpected state: \", this.state.repPhase)\r\n    }\r\n  },\r\n\r\n  belowSafetyPins() {\r\n\r\n    this.setMessage('Failed set.  Step out of rack and remove weight plates from bar.')\r\n\r\n  },\r\n\r\n  bailedOut() {\r\n    this.setMessage('Failed set.  Step out of rack and remove weight plates from bar.')\r\n  }\r\n})\r\n","AFRAME.registerComponent('vertical-controls', {\r\n\r\n  init() {\r\n\r\n    this.verticalVelocity = 0\r\n    this.verticalAcceleration = 0\r\n\r\n    this.keyDown = this.keyDown.bind(this)\r\n    this.keyUp = this.keyUp.bind(this)\r\n\r\n    window.addEventListener('keydown', this.keyDown)\r\n    window.addEventListener('keyup', this.keyUp)\r\n  },\r\n\r\n  keyDown(e) {\r\n\r\n    if (e.key === \"o\") {\r\n      this.verticalAcceleration += 2\r\n    }\r\n\r\n    if (e.key === \"k\") {\r\n      this.verticalAcceleration = -2\r\n    }\r\n  },\r\n\r\n  keyUp(e) {\r\n    \r\n    if (e.key === \"o\" || e.key === \"k\") {\r\n      this.verticalVelocity = 0\r\n      this.verticalAcceleration = 0\r\n    }\r\n  },\r\n\r\n  tick(t, dt) {\r\n\r\n    velDelta = dt * this.verticalAcceleration / 1000\r\n    this.verticalVelocity += velDelta\r\n    if (this.verticalVelocity > 1) this.verticalVelocity = 1\r\n    if (this.verticalVelocity < -1) this.verticalVelocity = -1\r\n\r\n    yDelta = dt * this.verticalVelocity / 1000\r\n    this.el.object3D.position.y += yDelta\r\n  }\r\n})","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/* global AFRAME, THREE */\r\n\r\nrequire('./src/bar-position.js')\r\nrequire('./src/bar-monitor.js')\r\nrequire('./src/in-rack-ui.js')\r\nrequire('./src/ui-updater.js')\r\nrequire('./src/squat-rack.js')\r\nrequire('./src/vertical-controls.js')\r\nrequire('./src/nod-shake.js')"],"names":[],"sourceRoot":""}